
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../Datalab/" rel="prev"/>
<link href="../Binalab/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.20" name="generator"/>
<title>CSAPP Bomblab - CSNote</title>
<link href="../../../assets/stylesheets/main.e53b48f4.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../stylesheets/extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet"/>
<link href="https://fonts.loli.net/css?family=JetBrains Mono:400,500,600,700&amp;display=swap" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="black" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#csapp-bomblab-solution">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="CSNote" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="CSNote">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            CSNote
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              CSAPP Bomblab
            
          </span>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="CSNote" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="CSNote">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    CSNote
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    index
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    OI-learning
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            OI-learning
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/">
<span class="md-ellipsis">
    intro
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/C%2B%2B%20OOP/">
<span class="md-ellipsis">
    C++ 面向对象
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-ellipsis">
    Algorithm
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            Algorithm
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Algorithm/STL_algorithm/">
<span class="md-ellipsis">
    STL 算法库 ref
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Algorithm/fastpow/">
<span class="md-ellipsis">
    快速幂
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
<span class="md-ellipsis">
    Data Structure
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            Data Structure
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Data-Structure/linkedlist/">
<span class="md-ellipsis">
    链表
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Data-Structure/vector/">
<span class="md-ellipsis">
    STL vector ref
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Data-Structure/stack/">
<span class="md-ellipsis">
    栈 &amp;&amp; 单调栈
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Data-Structure/queue/">
<span class="md-ellipsis">
    队列 &amp;&amp; 单调队列
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OI-Learning/Data-Structure/hashmap/">
<span class="md-ellipsis">
    哈希表
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Course Notes
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Course Notes
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
<span class="md-ellipsis">
    ICSPA x86 note
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_1">
<span class="md-nav__icon md-icon"></span>
            ICSPA x86 note
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICSPA-x86/PA0/">
<span class="md-ellipsis">
    PA0
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICSPA-x86/PA1/">
<span class="md-ellipsis">
    PA1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICSPA-x86/PA2-1/">
<span class="md-ellipsis">
    PA2-1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICSPA-x86/i386/">
<span class="md-ellipsis">
    i386 指令结构 for PA2-1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ICSPA-x86/PA2-2/">
<span class="md-ellipsis">
    PA2-2
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
<span class="md-ellipsis">
    网络攻防实战 note
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
            网络攻防实战 note
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Network-attack-and-defense-in-action/lab01/">
<span class="md-ellipsis">
    Lab01
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Network-attack-and-defense-in-action/lab02/">
<span class="md-ellipsis">
    Lab02
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Network-attack-and-defense-in-action/lab03/">
<span class="md-ellipsis">
    Lab03
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Network-attack-and-defense-in-action/lab04/">
<span class="md-ellipsis">
    Lab04
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Network-attack-and-defense-in-action/lab05/">
<span class="md-ellipsis">
    Lab05
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
<span class="md-ellipsis">
    ICS &amp;&amp; CSAPP Labs
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
            ICS &amp;&amp; CSAPP Labs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../intro/">
<span class="md-ellipsis">
    intro
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Datalab/">
<span class="md-ellipsis">
    CSAPP Datalab
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    CSAPP Bomblab
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    CSAPP Bomblab
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#solution">
<span class="md-ellipsis">
      Solution
    </span>
</a>
<nav aria-label="Solution" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-1">
<span class="md-ellipsis">
      Phase 1
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-2">
<span class="md-ellipsis">
      Phase 2
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-3">
<span class="md-ellipsis">
      Phase 3
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-4">
<span class="md-ellipsis">
      Phase 4
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-5">
<span class="md-ellipsis">
      Phase 5
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-6">
<span class="md-ellipsis">
      Phase 6
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#secret-phase">
<span class="md-ellipsis">
      Secret Phase
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#final-ans">
<span class="md-ellipsis">
      Final Ans
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Binalab/">
<span class="md-ellipsis">
    ICS Binalab
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Deep Learning
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Deep Learning
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Deep-Learning/intro/">
<span class="md-ellipsis">
    intro
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#solution">
<span class="md-ellipsis">
      Solution
    </span>
</a>
<nav aria-label="Solution" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-1">
<span class="md-ellipsis">
      Phase 1
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-2">
<span class="md-ellipsis">
      Phase 2
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-3">
<span class="md-ellipsis">
      Phase 3
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-4">
<span class="md-ellipsis">
      Phase 4
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-5">
<span class="md-ellipsis">
      Phase 5
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-6">
<span class="md-ellipsis">
      Phase 6
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#secret-phase">
<span class="md-ellipsis">
      Secret Phase
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#final-ans">
<span class="md-ellipsis">
      Final Ans
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="csapp-bomblab-solution">CSAPP Bomblab Solution</h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p>✍ 2245 words  | 🐛 703 codelines  | ⏰ 16 min read | Enjoy 🎶</p>
</div>
<p>二进制炸弹 <code>Bomb</code> 是一个由多个阶段组成的程序，每个阶段会要求用户在 <code>stdin</code> 输入特定字符串。若输入正确，该阶段即被拆除并进入下一阶段；否则程序将输出"BOOM! ! ! "后终止（即炸弹爆炸）。只有当所有阶段均被拆除后，炸弹才算彻底解除。</p>
<div class="admonition quote">
<p class="admonition-title">随笔</p>
<p>暑假写 Bomblab 的时候我只接触过 RISC-V 的汇编语言，没有 i386 汇编的阅读经验。因此这篇题解的语言比较细碎，并且对于 “寄存器存储值” 与 “寄存器存储地址指向值” 的概念有些区分不清（希望不会过度影响理解）</p>
<p>相比之下，Binalab 的题解显得更加熟练</p>
</div>
<hr/>
<h2 id="solution">Solution</h2>
<p>为了锻炼个人阅读 x86-64 汇编代码的能力，我采用的拆弹方案是直接分析反汇编代码，因此下面的操作将很少使用 gdb 工具</p>
<p>在进行对 <code>bomb</code> 的反编译之前，可以看一看旁边的 <code>bomb.c</code> 文件（这是一个提示作用的文件，展示了原程序 <code>&lt;main&gt;</code> 函数的流程），这个C程序告诉我们 <code>bomb</code> 的运行方式，比如：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_line</span><span class="p">();</span><span class="w">                </span><span class="cm">/* Get input                   */</span>
<span class="n">phase_1</span><span class="p">(</span><span class="n">input</span><span class="p">);</span><span class="w">                     </span><span class="cm">/* Run the phase               */</span>
<span class="n">phase_defused</span><span class="p">();</span><span class="w">                    </span><span class="cm">/* Drat!  They figured it out!</span>
<span class="cm">                                     * Let me know how they did it. */</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"Phase 1 defused. How about the next one?</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>另外最后的注释说明也暗示了总共不只有六个 bomb 需要拆除：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cm">/* Wow, they got it!  But isn't something... missing?  Perhaps</span>
<span class="cm"> * something they overlooked?  Mua ha ha ha ha! */</span>
</code></pre></div></td></tr></table></div>
<p><code>❯ objdump bomb -d -j .text</code> 开始拆弹（反编译代码段），可以看到很多标记点，而我们目前需要关注的只有 <code>&lt;main&gt;</code> 部分和 <code>&lt;phase&gt;</code> 部分。其中 <code>main</code> 部分从 <code>bomb.c</code> 文件中就能理解意思（初始化炸弹，检测输入判断炸弹是否爆炸等等），所以直接看六个阶段的汇编代码即可：</p>
<p>（有趣的是有一个 <code>&lt;secret_phase&gt;</code> 标记点，这对应了 <code>bomb.c</code> 中暗示的隐藏炸弹）</p>
<hr/>
<h3 id="phase-1">Phase 1</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">000000000400</span><span class="nf">ee0</span><span class="w"> </span><span class="err">&lt;</span><span class="no">phase_1</span><span class="err">&gt;</span><span class="p">:</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ee0:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x8</span><span class="p">,</span><span class="nv">%rsp</span><span class="w">                    </span><span class="c1"># 栈上分配 8byte 的空间（起对齐作用）</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ee4:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x402400</span><span class="p">,</span><span class="nv">%esi</span><span class="w">               </span><span class="c1"># 将 0x402400 这个地址加载到 %esi 中</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ee9:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">4</span><span class="no">a</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">401338</span> <span class="p">&lt;</span><span class="no">strings_not_equal</span><span class="p">&gt;</span><span class="w">   </span><span class="c1"># 调用执行 strings_not_equal 函数</span>
<span class="w">  </span><span class="err">400</span><span class="nl">eee:</span><span class="w">   </span><span class="err">85</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">test</span><span class="w">   </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                    </span><span class="c1"># 计算 %eax &amp; %eax，不保存结果，目的是改变标志位</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ef0:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">400ef7</span> <span class="p">&lt;</span><span class="no">phase_1</span><span class="p">+</span><span class="mi">0x17</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 当标志位 ZF==1 时跳转到 400ef7 （表示拆弹成功）</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ef2:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># BOOM!!!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ef7:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x8</span><span class="p">,</span><span class="nv">%rsp</span><span class="w">                    </span><span class="c1"># 释放栈空间</span>
<span class="w">  </span><span class="err">400</span><span class="nl">efb:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span><span class="w">                                 </span><span class="c1"># 结束子程序</span>

<span class="err">0000000000401338</span><span class="w"> </span><span class="err">&lt;</span><span class="nf">strings_not_equal</span><span class="err">&gt;</span><span class="p">:</span><span class="w"> </span><span class="c1"># 比较 %rdi 与 %rsi 指向的字符串是否不相等，不相等则返回 1，反之返回 0，此处反编译代码略</span>
</code></pre></div></td></tr></table></div>
<p><code>strings_not_equal</code> 比较的是输入 <code>%rdi</code> 和 <code>%rsi</code> 指向的字符串是否不相同，而两个相同的输入可以触发 <code>je</code> 的跳转避免炸弹爆炸</p>
<p>（标志位就是条件码）</p>
<p><code>400ee4</code> 处 <code>%esi</code> 被赋值为 <code>$0x402400</code> 的字符串，在gdb环境中对这个地址查看存储的字符串内容：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>❯<span class="w"> </span>gdb<span class="w"> </span>./bomb
GNU<span class="w"> </span>gdb<span class="w"> </span><span class="o">(</span>Ubuntu<span class="w"> </span><span class="m">12</span>.1-0ubuntu1~22.04.2<span class="o">)</span><span class="w"> </span><span class="m">12</span>.1
<span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>x/s<span class="w"> </span>0x402400
0x402400:<span class="w">   </span><span class="s2">"Border relations with Canada have never been better."</span>
</code></pre></div></td></tr></table></div>
<p>得到了第一个答案：<code>Border relations with Canada have never been better.</code></p>
<div class="admonition tip">
<p class="admonition-title">gdb 的 <code>x</code> 命令（e<strong>X</strong>amine memory）用于查看内存中的数据</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>x/<span class="o">[</span>N<span class="o">][</span>F<span class="o">][</span>U<span class="o">]</span><span class="w"> </span>&lt;address&gt;
</code></pre></div></td></tr></table></div>
<p><strong><code>N</code></strong>：显示的单位数量（可选，默认为1）。</p>
<p><strong><code>F</code></strong>：显示格式（如十六进制、十进制、字符串等）。</p>
<p><strong><code>U</code></strong>：单位大小（如字节、字、双字等）。</p>
<p><strong><code>&lt;address&gt;</code></strong>：内存地址（可以是寄存器、变量名或直接地址）。</p>
</div>
<h3 id="phase-2">Phase 2</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">0000000000400</span><span class="nf">efc</span><span class="w"> </span><span class="err">&lt;</span><span class="no">phase_2</span><span class="err">&gt;</span><span class="p">:</span>
<span class="w">  </span><span class="err">400</span><span class="nl">efc:</span><span class="w">   </span><span class="err">55</span><span class="w">                      </span><span class="nf">push</span><span class="w">   </span><span class="nv">%rbp</span>
<span class="w">  </span><span class="err">400</span><span class="nl">efd:</span><span class="w">   </span><span class="err">53</span><span class="w">                      </span><span class="nf">push</span><span class="w">   </span><span class="nv">%rbx</span><span class="w">                         </span><span class="c1"># 被调用者保存寄存器</span>
<span class="w">  </span><span class="err">400</span><span class="nl">efe:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">28</span><span class="w">             </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x28</span><span class="p">,</span><span class="nv">%rsp</span><span class="w">                   </span><span class="c1"># 开辟栈空间</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f02:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">e6</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rsi</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f05:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">52</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40145c</span> <span class="p">&lt;</span><span class="no">read_six_numbers</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 表明密码是六个（整）数</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f0a:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="err">3</span><span class="nf">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="no">cmpl</span><span class="w">   </span><span class="no">$0x1</span><span class="p">,(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">                  </span><span class="c1"># 根据 (%rsp) - 1 改变标志位</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f0e:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">20</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">400f30</span> <span class="p">&lt;</span><span class="no">phase_2</span><span class="p">+</span><span class="mi">0x34</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 如果相等就跳转，否则下一步 BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f10:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f15:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">19</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400f30</span> <span class="p">&lt;</span><span class="no">phase_2</span><span class="p">+</span><span class="mi">0x34</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 无条件跳转</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f17:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="no">fc</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="mi">-0</span><span class="no">x4</span><span class="p">(</span><span class="nv">%rbx</span><span class="p">),</span><span class="nv">%eax</span><span class="w">              </span><span class="c1"># 从 400f3a 跳转；将 (%rbx-4) 处数据存入 %eax</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f1a:</span><span class="w">   </span><span class="err">01</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">add</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                    </span><span class="c1"># %eax *= 2</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f1c:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="err">03</span><span class="w">                   </span><span class="nf">cmp</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,(</span><span class="nv">%rbx</span><span class="p">)</span><span class="w">                  </span><span class="c1"># 根据(%rbx) - %eax 设置标志位</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f1e:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">400f25</span> <span class="p">&lt;</span><span class="no">phase_2</span><span class="p">+</span><span class="mi">0x29</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 如果相等就跳转，否则下一步 BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f20:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f25:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c3</span><span class="w"> </span><span class="mi">04</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x4</span><span class="p">,</span><span class="nv">%rbx</span><span class="w">                    </span><span class="c1"># 从 400f1e 跳转；%rbx+=4</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f29:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">39</span><span class="w"> </span><span class="nf">eb</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%rbp</span><span class="p">,</span><span class="nv">%rbx</span><span class="w">                    </span><span class="c1"># 根据 %rbx - %rbp 改变标志位</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f2c:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="nf">e9</span><span class="w">                   </span><span class="no">jne</span><span class="w">    </span><span class="mh">400f17</span> <span class="p">&lt;</span><span class="no">phase_2</span><span class="p">+</span><span class="mi">0x1b</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 如果不相等就跳转回上一次跳转点（一次循环）</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f2e:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400f3c</span> <span class="p">&lt;</span><span class="no">phase_2</span><span class="p">+</span><span class="mi">0x40</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 无条件跳转，表示拆弹成功</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f30:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">5</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">04</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x4</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rbx</span><span class="w">               </span><span class="c1"># 从 400f0e 跳转；%rbx = %rsp+4</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f35:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">6</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">18</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rbp</span><span class="w">              </span><span class="c1"># %rbp = %rsp + 0x18</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f3a:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="no">db</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400f17</span> <span class="p">&lt;</span><span class="no">phase_2</span><span class="p">+</span><span class="mi">0x1b</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 无条件跳转</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f3c:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">28</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x28</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f40:</span><span class="w">   </span><span class="err">5</span><span class="nf">b</span><span class="w">                      </span><span class="no">pop</span><span class="w">    </span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f41:</span><span class="w">   </span><span class="err">5</span><span class="nf">d</span><span class="w">                      </span><span class="no">pop</span><span class="w">    </span><span class="nv">%rbp</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f42:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span>

<span class="err">000000000040145</span><span class="nf">c</span><span class="w"> </span><span class="err">&lt;</span><span class="no">read_six_numbers</span><span class="err">&gt;</span><span class="p">:</span><span class="w"> </span><span class="c1"># 读取六个数</span>
<span class="na">...</span><span class="w"> </span><span class="no">...</span>
<span class="w">  </span><span class="err">401480:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="no">c3</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x4025c3</span><span class="p">,</span><span class="nv">%esi</span>
<span class="na">...</span><span class="w"> </span><span class="no">...</span>
<span class="c1"># (gdb) x/s 0x4025c3</span>
<span class="c1"># 0x4025c3: "%d %d %d %d %d %d"</span>
<span class="c1"># 说明读取的是整数，数字之间用空格分隔</span>
</code></pre></div></td></tr></table></div>
<p>首先看最开始的这一部分：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="err">400</span><span class="nl">f0a:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="err">3</span><span class="nf">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="no">cmpl</span><span class="w">   </span><span class="no">$0x1</span><span class="p">,(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">                  </span><span class="c1"># 根据 (%rsp) - 1 改变标志位</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f0e:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">20</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">400f30</span> <span class="p">&lt;</span><span class="no">phase_2</span><span class="p">+</span><span class="mi">0x34</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 如果相等就跳转，否则下一步 BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f10:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># BOOM!</span>
</code></pre></div></td></tr></table></div>
<p>很明显，第一个数字要输入 <code>1</code> ，否则炸弹爆炸</p>
<p>然后看这一部分</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="err">400</span><span class="nl">f30:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">5</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">04</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x4</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rbx</span><span class="w">               </span><span class="c1"># 从 400f0e 跳转；%rbx = %rsp+4</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f35:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">6</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">18</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rbp</span><span class="w">              </span><span class="c1"># %rbp = %rsp + 0x18</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f3a:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="no">db</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400f17</span> <span class="p">&lt;</span><span class="no">phase_2</span><span class="p">+</span><span class="mi">0x1b</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 无条件跳转</span>
</code></pre></div></td></tr></table></div>
<p>这里程序设定了 <code>%rbx</code> 存储第二个数字<strong>的地址</strong>，<code>%rbp</code> 为第六个数字之后<strong>的地址</strong>（<code>0x18</code> = 24 = 6 int），接着跳转到一个循环部分</p>
<p>结合后面的程序可以看得出来，这段代码可以类比 <code>for (int i = 1; i &lt; 6; i++)</code> 的前两个参数设置</p>
<p>接着是这一部分，看上去是个有限循环</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="err">400</span><span class="nl">f17:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="no">fc</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="mi">-0</span><span class="no">x4</span><span class="p">(</span><span class="nv">%rbx</span><span class="p">),</span><span class="nv">%eax</span><span class="w">              </span><span class="c1"># 从 400f3a 跳转；将 (%rbx-4) 处数据存入 %eax</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f1a:</span><span class="w">   </span><span class="err">01</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">add</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                    </span><span class="c1"># %eax *= 2</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f1c:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="err">03</span><span class="w">                   </span><span class="nf">cmp</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,(</span><span class="nv">%rbx</span><span class="p">)</span><span class="w">                  </span><span class="c1"># 根据(%rbx) - %eax 设置标志位</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f1e:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">400f25</span> <span class="p">&lt;</span><span class="no">phase_2</span><span class="p">+</span><span class="mi">0x29</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 如果相等就跳转，否则下一步 BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f20:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f25:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c3</span><span class="w"> </span><span class="mi">04</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x4</span><span class="p">,</span><span class="nv">%rbx</span><span class="w">                    </span><span class="c1"># 从 400f1e 跳转；%rbx+=4</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f29:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">39</span><span class="w"> </span><span class="nf">eb</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%rbp</span><span class="p">,</span><span class="nv">%rbx</span><span class="w">                    </span><span class="c1"># 根据 %rbx - %rbp 改变标志位</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f2c:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="nf">e9</span><span class="w">                   </span><span class="no">jne</span><span class="w">    </span><span class="mh">400f17</span> <span class="p">&lt;</span><span class="no">phase_2</span><span class="p">+</span><span class="mi">0x1b</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 如果不相等就跳转回上一次跳转点（一次循环）</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f2e:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400f3c</span> <span class="p">&lt;</span><span class="no">phase_2</span><span class="p">+</span><span class="mi">0x40</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 无条件跳转，表示拆弹成功</span>
</code></pre></div></td></tr></table></div>
<p>这里直接写出对应的 C 语言代码了，其中规定 <code>%rsp</code> 开始的六个数字组成数组 <code>stack[6]</code> ，<code>%rbx + 4</code> 表示 <code>i++</code> </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">EAX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">];</span><span class="w">                                               </span><span class="c1">// EAX 为 “上一个数字”</span>
<span class="w">    </span><span class="n">EAX</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">                                                           </span><span class="c1">// EAX 为 “上一个数字” 的两倍</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">EAX</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w">                                            </span><span class="c1">// ZF == 1 ?</span>
<span class="w">    </span><span class="k">continue</span><span class="p">;</span><span class="w">                                                           </span><span class="c1">// 跳过引爆炸弹的函数</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">explode_bomb</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>由此可见，接下来的五个数字都要求每个数字是上一个数字的两倍，因此第二个答案是 <code>1 2 4 8 16 32</code> </p>
<h3 id="phase-3">Phase 3</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">0000000000400</span><span class="nf">f43</span><span class="w"> </span><span class="err">&lt;</span><span class="no">phase_3</span><span class="err">&gt;</span><span class="p">:</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f43:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x18</span><span class="p">,</span><span class="nv">%rsp</span><span class="w">                   </span><span class="c1"># 开辟栈空间</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f47:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">4</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0xc</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rcx</span><span class="w">               </span><span class="c1"># %rcx = %rsp + 12（地址计算）</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f4c:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rdx</span><span class="w">               </span><span class="c1"># %rdx = %rsp + 8（地址计算）</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f51:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="no">cf</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x4025cf</span><span class="p">,</span><span class="nv">%esi</span><span class="w">               </span><span class="c1"># (gdb) x/s 0x4025cf: "%d %d", 赋值给 %esi</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f56:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                    </span><span class="c1"># %eax = 0</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f5b:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="no">fc</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400bf0</span> <span class="p">&lt;</span><span class="no">__isoc99_sscanf@plt</span><span class="p">&gt;</span><span class="w"> </span><span class="c1"># 调用标准库函数 sscanf，读取的内容参见 0x4025cf</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f60:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                    </span><span class="c1"># 比较 %eax ~ 1</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f63:</span><span class="w">   </span><span class="err">7</span><span class="nf">f</span><span class="w"> </span><span class="mi">05</span><span class="w">                   </span><span class="no">jg</span><span class="w">     </span><span class="mh">400f6a</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x27</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 有符号 “大于” 成立则跳过引爆代码，否则 BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f65:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">d0</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f6a:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="err">7</span><span class="nf">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w"> </span><span class="mi">07</span><span class="w">          </span><span class="no">cmpl</span><span class="w">   </span><span class="no">$0x7</span><span class="p">,</span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">               </span><span class="c1"># 比较 (%rsp + 8) ~ 7</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f6f:</span><span class="w">   </span><span class="err">77</span><span class="w"> </span><span class="err">3</span><span class="nf">c</span><span class="w">                   </span><span class="no">ja</span><span class="w">     </span><span class="mh">400fad</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x6a</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 无符号 “大于” 成立则跳转至引爆代码，否则继续向下运行</span>

<span class="w">  </span><span class="err">400</span><span class="nl">f71:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%eax</span><span class="w">               </span><span class="c1"># %eax = %rsp + 8</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f75:</span><span class="w">   </span><span class="nf">ff</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="no">c5</span><span class="w"> </span><span class="mi">70</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="no">jmp</span><span class="w">    </span><span class="p">*</span><span class="mi">0x402470</span><span class="p">(,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w">           </span><span class="c1"># 这里是间接跳转中的跳转表跳转，是 switch 语句的实现</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f7c:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="no">cf</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0xcf</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                   </span><span class="c1"># %eax = 207</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f81:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">3</span><span class="no">b</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f83:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="no">c3</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x2c3</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 707</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f88:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">34</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f8a:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x100</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 256</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f8f:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">2</span><span class="no">d</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f91:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">85</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x185</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 389</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f96:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">26</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f98:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="no">ce</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0xce</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                   </span><span class="c1"># %eax = 206</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f9d:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">1</span><span class="no">f</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f9f:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="no">aa</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x2aa</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 682</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fa4:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">18</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fa6:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x147</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 327</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fab:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">11</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fad:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">88</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fb2:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                    </span><span class="c1"># %eax = 0</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fb7:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">05</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fb9:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x137</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 311</span>

<span class="w">  </span><span class="err">400</span><span class="nl">fbe:</span><span class="w">   </span><span class="err">3</span><span class="nf">b</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w">             </span><span class="no">cmp</span><span class="w">    </span><span class="mi">0xc</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%eax</span><span class="w">               </span><span class="c1"># 比较 %eax ~ (%rsp + 12)</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fc2:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">400fc9</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x86</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 若 “相等” 成立则成功拆弹</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fc4:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">71</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fc9:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x18</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fcd:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span><span class="w">    </span>
</code></pre></div></td></tr></table></div>
<p>先看第一部分：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="err">400</span><span class="nl">f43:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x18</span><span class="p">,</span><span class="nv">%rsp</span><span class="w">                   </span><span class="c1"># 开辟栈空间</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f47:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">4</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0xc</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rcx</span><span class="w">               </span><span class="c1"># %rcx = %rsp + 12</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f4c:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rdx</span><span class="w">               </span><span class="c1"># %rdx = %rsp + 8</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f51:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="no">cf</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x4025cf</span><span class="p">,</span><span class="nv">%esi</span><span class="w">               </span><span class="c1"># (gdb) x/s 0x4025cf: "%d %d", 赋值给 %esi</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f56:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                    </span><span class="c1"># %eax = 0</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f5b:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="no">fc</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400bf0</span> <span class="p">&lt;</span><span class="no">__isoc99_sscanf@plt</span><span class="p">&gt;</span><span class="w"> </span><span class="c1"># 调用标准库函数 sscanf，读取的内容参见 0x4025cf</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f60:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                    </span><span class="c1"># 比较 %eax ~ 1</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f63:</span><span class="w">   </span><span class="err">7</span><span class="nf">f</span><span class="w"> </span><span class="mi">05</span><span class="w">                   </span><span class="no">jg</span><span class="w">     </span><span class="mh">400f6a</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x27</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 有符号 “大于” 成立则跳过引爆代码，否则 BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f65:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">d0</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f6a:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="err">7</span><span class="nf">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w"> </span><span class="mi">07</span><span class="w">          </span><span class="no">cmpl</span><span class="w">   </span><span class="no">$0x7</span><span class="p">,</span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">               </span><span class="c1"># 比较 (%rsp + 8) ~ 7</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f6f:</span><span class="w">   </span><span class="err">77</span><span class="w"> </span><span class="err">3</span><span class="nf">c</span><span class="w">                   </span><span class="no">ja</span><span class="w">     </span><span class="mh">400fad</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x6a</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 无符号 “大于” 成立则跳转至引爆代码，否则继续向下运行</span>
</code></pre></div></td></tr></table></div>
<p><code>mov $0x4025cf,%esi</code>  这一句可以知道需要读取的是两个整数</p>
<div class="admonition tip">
<p class="admonition-title">About <code>sscanf</code></p>
<p><code>sscanf</code> 的函数原型中，第一个参数 <code>%rdi</code> 是输入字符串的指针，第二个参数是格式字符串的指针，这里也就是 <code>0x4025cf</code> 的内容； <code>%rdx</code> 与 <code>%rcx</code> 分别存储第一个、第二个结果的地址（之后的参数依次 <code>r8</code> 和 <code>r9</code> 存储，接着会使用栈传递）</p>
<p>因此两个 <code>lea</code> 语句看似没有作用，实则表示了两个整数的地址</p>
</div>
<p><code>%eax</code> 根据约定被设定为 <code>sscanf</code> 的返回值，<code>400f60 ~ 400f65</code> 的判断跳转说明 “如果 <code>%eax</code> 的值，也就是输入的整数个数没达到 2 个，直接引爆炸弹”</p>
<p>接下来 <code>cmpl $0x7,0x8(%rsp)</code> 及其后面的跳转表明：第一个数（也就是 <code>0x8(%rsp)</code> , 也就是 <code>%rdx</code> 的对应值）必须 <code>&lt;= 7</code> ，否则炸弹爆炸（因为是无符号比较，所以负数输入都不正确）</p>
<p>总结：需要输入两个数；第一个数不能超过 <code>7</code> </p>
<p>再看第二部分：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="err">400</span><span class="nl">f71:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%eax</span><span class="w">               </span><span class="c1"># %eax = %rsp + 8</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f75:</span><span class="w">   </span><span class="nf">ff</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="no">c5</span><span class="w"> </span><span class="mi">70</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="no">jmp</span><span class="w">    </span><span class="p">*</span><span class="mi">0x402470</span><span class="p">(,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w">           </span><span class="c1"># 这里是间接跳转中的跳转表跳转，是 switch 语句的实现</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f7c:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="no">cf</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0xcf</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                   </span><span class="c1"># %eax = 207</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f81:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">3</span><span class="no">b</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f83:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="no">c3</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x2c3</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 707</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f88:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">34</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f8a:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x100</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 256</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f8f:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">2</span><span class="no">d</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f91:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">85</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x185</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 389</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f96:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">26</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f98:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="no">ce</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0xce</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                   </span><span class="c1"># %eax = 206</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f9d:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">1</span><span class="no">f</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">f9f:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="no">aa</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x2aa</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 682</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fa4:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">18</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fa6:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x147</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 327</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fab:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">11</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fad:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">88</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fb2:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                    </span><span class="c1"># %eax = 0</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fb7:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">05</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">400fbe</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x7b</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fb9:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x137</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %eax = 311</span>
</code></pre></div></td></tr></table></div>
<p>第一步 <code>mov 0x8(%rsp),%eax</code> 把第一个输入的数字复制到了 <code>%eax</code> </p>
<p>接下来关键的一步 <code>jmp *0x402470(,%rax,8)</code> 是跳转表跳转。使用 <code>gdb x</code> 查看跳转表内容</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>x/8gx<span class="w"> </span>0x402470<span class="w">    </span><span class="c1"># 以双字为单位，显示 8 个连续的十六进制数值（考虑到 %rdx 值 &lt;= 7，显示 8 个值足够）</span>
0x402470:<span class="w">   </span>0x0000000000400f7c<span class="w">  </span>0x0000000000400fb9
0x402480:<span class="w">   </span>0x0000000000400f83<span class="w">  </span>0x0000000000400f8a
0x402490:<span class="w">   </span>0x0000000000400f91<span class="w">  </span>0x0000000000400f98
0x4024a0:<span class="w">   </span>0x0000000000400f9f<span class="w">  </span>0x0000000000400fa6
</code></pre></div></td></tr></table></div>
<p><code>*0x402470(,%rax,8)</code> 表示内存间接寻址，可以理解为以 <code>0x402470</code> 为基址，加上 <code>%rax</code> 个 <code>64bit</code> 的偏移量，比如 <code>%rax</code> 为 <code>1</code> 时，就跳转到 <code>400fb9</code> </p>
<p>不妨就以输入的第一个数字为 <code>1</code> 为例，此时 <code>%eax</code> 被赋值为 <code>311</code> </p>
<p>最后看第三部分：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="err">400</span><span class="nl">fbe:</span><span class="w">   </span><span class="err">3</span><span class="nf">b</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w">             </span><span class="no">cmp</span><span class="w">    </span><span class="mi">0xc</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%eax</span><span class="w">               </span><span class="c1"># 比较 %eax ~ (%rsp + 12)</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fc2:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">400fc9</span> <span class="p">&lt;</span><span class="no">phase_3</span><span class="p">+</span><span class="mi">0x86</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># 若 “相等” 成立则成功拆弹</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fc4:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">71</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">        </span><span class="c1"># BOOM!</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fc9:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x18</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fcd:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span><span class="w">    </span>
</code></pre></div></td></tr></table></div>
<p>简单来说就是：如果上一部分设定的 <code>%eax</code> 与第二个输入相等就解除炸弹，否则引爆。比如 <code>%rdx</code> 值为 <code>1</code> 时，必须有 <code>%rcx</code> 值为 <code>311</code> 。也就是说跳转表决定了共计 8 个 <code>%rdx</code> 输入对应的唯一的 <code>%rcx</code> ：</p>
<table>
<tr>
<td>%rdx</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
</tr>
<tr>
<td>%rcx</td>
<td>207</td>
<td>311</td>
<td>707</td>
<td>256</td>
<td>389</td>
<td>206</td>
<td>682</td>
<td>327</td>
</tr>
</table>
<p>在上面的组合中随意选择一项作为答案就可以拆除第三个炸弹，比如 <code>2 707</code> </p>
<h3 id="phase-4">Phase 4</h3>
<p>（减少了注释量）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">000000000040100</span><span class="nf">c</span><span class="w"> </span><span class="err">&lt;</span><span class="no">phase_4</span><span class="err">&gt;</span><span class="p">:</span>
<span class="w">  </span><span class="err">40100</span><span class="nl">c:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x18</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">401010:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">4</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0xc</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rcx</span>
<span class="w">  </span><span class="err">401015:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rdx</span>
<span class="w">  </span><span class="err">40101</span><span class="nl">a:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="no">cf</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x4025cf</span><span class="p">,</span><span class="nv">%esi</span>
<span class="w">  </span><span class="err">40101</span><span class="nl">f:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">401024:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">c7</span><span class="w"> </span><span class="no">fb</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400bf0</span> <span class="p">&lt;</span><span class="no">__isoc99_sscanf@plt</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401029:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">02</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x2</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40102</span><span class="nl">c:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="err">07</span><span class="w">                   </span><span class="nf">jne</span><span class="w">    </span><span class="mh">401035</span> <span class="p">&lt;</span><span class="no">phase_4</span><span class="p">+</span><span class="mi">0x29</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40102</span><span class="nl">e:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="err">7</span><span class="nf">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w"> </span><span class="mi">0</span><span class="no">e</span><span class="w">          </span><span class="no">cmpl</span><span class="w">   </span><span class="no">$0xe</span><span class="p">,</span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">)</span>
<span class="w">  </span><span class="err">401033:</span><span class="w">   </span><span class="err">76</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">jbe</span><span class="w">    </span><span class="mh">40103a</span> <span class="p">&lt;</span><span class="no">phase_4</span><span class="p">+</span><span class="mi">0x2e</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401035:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span>

<span class="w">  </span><span class="err">40103</span><span class="nl">a:</span><span class="w">   </span><span class="nf">ba</span><span class="w"> </span><span class="mi">0</span><span class="no">e</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0xe</span><span class="p">,</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">40103</span><span class="nl">f:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%esi</span>
<span class="w">  </span><span class="err">401044:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">7</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%edi</span>
<span class="w">  </span><span class="err">401048:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400fce</span> <span class="p">&lt;</span><span class="no">func4</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40104</span><span class="nl">d:</span><span class="w">   </span><span class="err">85</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">test</span><span class="w">   </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40104</span><span class="nl">f:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="err">07</span><span class="w">                   </span><span class="nf">jne</span><span class="w">    </span><span class="mh">401058</span> <span class="p">&lt;</span><span class="no">phase_4</span><span class="p">+</span><span class="mi">0x4c</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401051:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="err">7</span><span class="nf">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">cmpl</span><span class="w">   </span><span class="no">$0x0</span><span class="p">,</span><span class="mi">0xc</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">)</span>
<span class="w">  </span><span class="err">401056:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">40105d</span> <span class="p">&lt;</span><span class="no">phase_4</span><span class="p">+</span><span class="mi">0x51</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401058:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">dd</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40105</span><span class="nl">d:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x18</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">401061:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span><span class="w">    </span>
</code></pre></div></td></tr></table></div>
<p>先看这部分：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="err">40100</span><span class="nl">c:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x18</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">401010:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">4</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0xc</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rcx</span>
<span class="w">  </span><span class="err">401015:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rdx</span>
<span class="w">  </span><span class="err">40101</span><span class="nl">a:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="no">cf</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x4025cf</span><span class="p">,</span><span class="nv">%esi</span><span class="w">               </span><span class="c1"># (gdb) x/s 0x4025cf: "%d %d", 赋值给 %esi</span>
<span class="w">  </span><span class="err">40101</span><span class="nl">f:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">401024:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">c7</span><span class="w"> </span><span class="no">fb</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400bf0</span> <span class="p">&lt;</span><span class="no">__isoc99_sscanf@plt</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401029:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">02</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x2</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40102</span><span class="nl">c:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="err">07</span><span class="w">                   </span><span class="nf">jne</span><span class="w">    </span><span class="mh">401035</span> <span class="p">&lt;</span><span class="no">phase_4</span><span class="p">+</span><span class="mi">0x29</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40102</span><span class="nl">e:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="err">7</span><span class="nf">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w"> </span><span class="mi">0</span><span class="no">e</span><span class="w">          </span><span class="no">cmpl</span><span class="w">   </span><span class="no">$0xe</span><span class="p">,</span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">)</span>
<span class="w">  </span><span class="err">401033:</span><span class="w">   </span><span class="err">76</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">jbe</span><span class="w">    </span><span class="mh">40103a</span> <span class="p">&lt;</span><span class="no">phase_4</span><span class="p">+</span><span class="mi">0x2e</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401035:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>这一部分和上一阶段几乎一样：读取两个整数；如果输入的整数个数不为 <code>2</code> 则爆炸，否则让第一个数字与 <code>14</code> 比较，如果第一个数字 <code>&lt;= 14</code> 则跳转至下一部分（因为是无符号比较，所以负数输入都不正确），否则炸弹爆炸</p>
<p>于是我们知道了答案是两个数字，并且第一个数字是不超过 <code>14</code> 的非负数 </p>
<p>再看另一部分：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="err">40103</span><span class="nl">a:</span><span class="w">   </span><span class="nf">ba</span><span class="w"> </span><span class="mi">0</span><span class="no">e</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0xe</span><span class="p">,</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">40103</span><span class="nl">f:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%esi</span>
<span class="w">  </span><span class="err">401044:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">7</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%edi</span>
<span class="w">  </span><span class="err">401048:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400fce</span> <span class="p">&lt;</span><span class="no">func4</span><span class="p">&gt;</span><span class="w">           </span><span class="c1"># 调用一个神秘函数</span>
<span class="w">  </span><span class="err">40104</span><span class="nl">d:</span><span class="w">   </span><span class="err">85</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">test</span><span class="w">   </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># 只有返回值 %eax == 0 时使 ZF 置 1，和下一条指令结合使用</span>
<span class="w">  </span><span class="err">40104</span><span class="nl">f:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="err">07</span><span class="w">                   </span><span class="nf">jne</span><span class="w">    </span><span class="mh">401058</span> <span class="p">&lt;</span><span class="no">phase_4</span><span class="p">+</span><span class="mi">0x4c</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># ZF == 0 时跳转爆炸，也就是说 func4 的返回值必须是 0</span>
<span class="w">  </span><span class="err">401051:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="err">7</span><span class="nf">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">cmpl</span><span class="w">   </span><span class="no">$0x0</span><span class="p">,</span><span class="mi">0xc</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">           </span><span class="c1"># 第二个数与 0 比较</span>
<span class="w">  </span><span class="err">401056:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">40105d</span> <span class="p">&lt;</span><span class="no">phase_4</span><span class="p">+</span><span class="mi">0x51</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 第二个数如果等于 0 ，则解除炸弹，否则引爆</span>
<span class="w">  </span><span class="err">401058:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">dd</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40105</span><span class="nl">d:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x18</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">401061:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span><span class="w">  </span>
</code></pre></div></td></tr></table></div>
<p>将 <code>%esi</code> 与 <code>%edx</code> 分别设置为 <code>0</code> 和 <code>14</code>，<code>%edi</code> 设置为第一个输入，然后调用 <code>func4</code> 函数，当且仅当返回值为 <code>0</code> 并且第二个输入的数为 <code>0</code> 时解除炸弹</p>
<p>现在来看 <code>func4</code> ：（<code>%rdx</code> 与 <code>%rcx</code> 分别储存了两个输入的数的地址而不是值；<code>%edi</code> 储存了第一个数的值）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">0000000000400</span><span class="nf">fce</span><span class="w"> </span><span class="err">&lt;</span><span class="no">func4</span><span class="err">&gt;</span><span class="p">:</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fce:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x8</span><span class="p">,</span><span class="nv">%rsp</span><span class="w">                </span><span class="c1"># 开辟了一个 int 大小的栈空间</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fd2:</span><span class="w">   </span><span class="err">89</span><span class="w"> </span><span class="nf">d0</span><span class="w">                   </span><span class="no">mov</span><span class="w">    </span><span class="nv">%edx</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># %eax = %edx</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fd4:</span><span class="w">   </span><span class="err">29</span><span class="w"> </span><span class="nf">f0</span><span class="w">                   </span><span class="no">sub</span><span class="w">    </span><span class="nv">%esi</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># %eax -= %esi </span>
<span class="w">  </span><span class="err">400</span><span class="nl">fd6:</span><span class="w">   </span><span class="err">89</span><span class="w"> </span><span class="nf">c1</span><span class="w">                   </span><span class="no">mov</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%ecx</span><span class="w">                </span><span class="c1"># %ecx = %eax</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fd8:</span><span class="w">   </span><span class="nf">c1</span><span class="w"> </span><span class="no">e9</span><span class="w"> </span><span class="mi">1</span><span class="no">f</span><span class="w">                </span><span class="no">shr</span><span class="w">    </span><span class="no">$0x1f</span><span class="p">,</span><span class="nv">%ecx</span><span class="w">               </span><span class="c1"># %ecx 逻辑右移 31 位，也就是取符号位</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fdb:</span><span class="w">   </span><span class="err">01</span><span class="w"> </span><span class="nf">c8</span><span class="w">                   </span><span class="no">add</span><span class="w">    </span><span class="nv">%ecx</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># %eax += %ecx</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fdd:</span><span class="w">   </span><span class="nf">d1</span><span class="w"> </span><span class="no">f8</span><span class="w">                   </span><span class="no">sar</span><span class="w">    </span><span class="nv">%eax</span><span class="w">                     </span><span class="c1"># %eax 算术右移 1 位，也就是 %eax // 2</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fdf:</span><span class="w">   </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w"> </span><span class="mi">30</span><span class="w">                </span><span class="no">lea</span><span class="w">    </span><span class="p">(</span><span class="nv">%rax</span><span class="p">,</span><span class="nv">%rsi</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nv">%ecx</span><span class="w">       </span><span class="c1"># %ecx = %rax + %rsi （地址计算）</span>

<span class="w">  </span><span class="err">400</span><span class="nl">fe2:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="nf">f9</span><span class="w">                   </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%edi</span><span class="p">,</span><span class="nv">%ecx</span><span class="w">                </span><span class="c1"># 比较 %ecx ~ %edi</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fe4:</span><span class="w">   </span><span class="err">7</span><span class="nf">e</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w">                   </span><span class="no">jle</span><span class="w">    </span><span class="mh">400ff2</span> <span class="p">&lt;</span><span class="no">func4</span><span class="p">+</span><span class="mi">0x24</span><span class="p">&gt;</span><span class="w">      </span><span class="c1"># 如果 &lt;= 成立就跳转至 400ff2，否则继续</span>
<span class="w">  </span><span class="c1"># 在 %ecx &gt; %edi （值比较）情况下</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fe6:</span><span class="w">   </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">51</span><span class="w"> </span><span class="no">ff</span><span class="w">                </span><span class="no">lea</span><span class="w">    </span><span class="mi">-0</span><span class="no">x1</span><span class="p">(</span><span class="nv">%rcx</span><span class="p">),</span><span class="nv">%edx</span><span class="w">          </span><span class="c1"># %edx = %rcx - 1（地址计算）</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fe9:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">e0</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400fce</span> <span class="p">&lt;</span><span class="no">func4</span><span class="p">&gt;</span><span class="w">           </span><span class="c1"># 递归调用自身！</span>
<span class="w">  </span><span class="err">400</span><span class="nl">fee:</span><span class="w">   </span><span class="err">01</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">add</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># %eax *= 2，也就是返回值乘以 2</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ff0:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">15</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">401007</span> <span class="p">&lt;</span><span class="no">func4</span><span class="p">+</span><span class="mi">0x39</span><span class="p">&gt;</span><span class="w">      </span><span class="c1"># 跳转结束函数调用</span>
<span class="w">  </span><span class="c1"># 在 %ecx &lt;= %edi 情况下：</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ff2:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># %eax = 0</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ff7:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="nf">f9</span><span class="w">                   </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%edi</span><span class="p">,</span><span class="nv">%ecx</span><span class="w">                </span><span class="c1"># 比较 %ecx ~ %edi</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ff9:</span><span class="w">   </span><span class="err">7</span><span class="nf">d</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w">                   </span><span class="no">jge</span><span class="w">    </span><span class="mh">401007</span> <span class="p">&lt;</span><span class="no">func4</span><span class="p">+</span><span class="mi">0x39</span><span class="p">&gt;</span><span class="w">      </span><span class="c1"># 如果 &gt;= 成立跳转结束函数调用</span>
<span class="w">  </span><span class="c1"># 在 %ecx &lt; %edi 情况下：</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ffb:</span><span class="w">   </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">71</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x1</span><span class="p">(</span><span class="nv">%rcx</span><span class="p">),</span><span class="nv">%esi</span><span class="w">           </span><span class="c1"># %esi = %rcx + 1（地址计算）</span>
<span class="w">  </span><span class="err">400</span><span class="nl">ffe:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">cb</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400fce</span> <span class="p">&lt;</span><span class="no">func4</span><span class="p">&gt;</span><span class="w">           </span><span class="c1"># 递归调用自身！</span>
<span class="w">  </span><span class="err">401003:</span><span class="w">   </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x1</span><span class="p">(</span><span class="nv">%rax</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nv">%eax</span><span class="w">    </span><span class="c1"># %eax = 2 * %rax + 1 （地址计算）</span>
<span class="w">  </span><span class="err">401007:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x8</span><span class="p">,</span><span class="nv">%rsp</span><span class="w">                </span><span class="c1"># 释放栈空间</span>
<span class="w">  </span><span class="err">40100</span><span class="nl">b:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span><span class="w">                             </span><span class="c1"># 退出函数，返回值是 %eax</span>
</code></pre></div></td></tr></table></div>
<p>这是一个递归函数，我们尝试用 C 语言去描述上面的行为：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// scanf("%d %d",&amp;x,&amp;y); </span>
<span class="c1">// 前面的一些操作可以理解为 edx = &amp;x; ecx = &amp;y; edi = x;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">func4</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">edi</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">esi</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">edx</span><span class="p">){</span><span class="w">                               </span><span class="c1">// 更加易读的：func4(int target, int left, int right)</span>
<span class="w">    </span><span class="n">eax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">edi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">esi</span><span class="p">;</span><span class="w"> </span><span class="n">ecx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eax</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ecx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">eax</span><span class="o">++</span><span class="p">;</span><span class="w">                                              </span><span class="c1">// 原代码是通过获取符号位的方式进行负数的二分中点值调整</span>
<span class="w">    </span><span class="n">ecx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">eax</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">esi</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// 到这里的操作可以总结成：mid = l + (r - l) // 2，也就是二分查找计算中点值 </span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ecx</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">edi</span><span class="p">){</span><span class="w">                                                 </span><span class="c1">// 400fe4: jle 400ff2 &lt;func4+0x24&gt;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ecx</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">edi</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">                                   </span><span class="c1">// 400ff9: jge 401007 &lt;func4+0x39&gt;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">func4</span><span class="p">(</span><span class="n">edi</span><span class="p">,</span><span class="w"> </span><span class="n">ecx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">edx</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">func4</span><span class="p">(</span><span class="n">edi</span><span class="p">,</span><span class="w"> </span><span class="n">esi</span><span class="p">,</span><span class="w"> </span><span class="n">ecx</span><span class="mi">-1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>一个典型的二分查找，只有找到这个目标值 <code>edi = x</code> 才会返回 <code>0</code> 值（另外那个负数偏移调整没有必要，因为输入的整数已经限制为了非负数）</p>
<p>所以我的第一个输入必须可以直接在二分查找的时候被精准定位：</p>
<p><code>14 // 2 = 7</code> <code>7 // 2 = 3</code> <code>3 // 2 = 1</code> <code>1 // 2 = 0</code> 这四次二分查找时出现的中间值 <code>mid</code> 就是所有成立的第一个输入</p>
<p>也就是说 <code>7 0</code> <code>3 0</code> <code>1 0</code> <code>0 0</code> 都是正确答案</p>
<h3 id="phase-5">Phase 5</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">0000000000401062</span><span class="w"> </span><span class="err">&lt;</span><span class="nf">phase_5</span><span class="err">&gt;</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Part 1</span>
<span class="w">  </span><span class="err">401062:</span><span class="w">   </span><span class="err">53</span><span class="w">                      </span><span class="nf">push</span><span class="w">   </span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">401063:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x20</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">401067:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">fb</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rdi</span><span class="p">,</span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">40106</span><span class="nl">a:</span><span class="w">   </span><span class="err">64</span><span class="w"> </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="no">mov</span><span class="w">    </span><span class="nv">%fs</span><span class="p">:</span><span class="mi">0x28</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">401071:</span><span class="w">   </span><span class="err">00</span><span class="w"> </span><span class="err">00</span><span class="w"> </span>
<span class="w">  </span><span class="err">401073:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="err">44</span><span class="w"> </span><span class="err">24</span><span class="w"> </span><span class="err">18</span><span class="w">          </span><span class="nf">mov</span><span class="w">    </span><span class="nv">%rax</span><span class="p">,</span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">          </span><span class="c1"># 将 %rax 的值存入栈地址 %rsp + 24 处</span>
<span class="w">  </span><span class="err">401078:</span><span class="w">   </span><span class="err">31</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">xor</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># 利用异或操作清零 %eax</span>
<span class="w">  </span><span class="err">40107</span><span class="nl">a:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">9</span><span class="no">c</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40131b</span> <span class="p">&lt;</span><span class="no">string_length</span><span class="p">&gt;</span><span class="w">   </span><span class="c1"># 返回字符串的长度</span>
<span class="w">  </span><span class="err">40107</span><span class="nl">f:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">06</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x6</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># 返回值与 6 比较</span>
<span class="w">  </span><span class="err">401082:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">4</span><span class="nf">e</span><span class="w">                   </span><span class="no">je</span><span class="w">     </span><span class="mh">4010d2</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x70</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 如果相等则跳转，否则爆炸</span>
<span class="w">  </span><span class="err">401084:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">b1</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># BOOM! </span>
<span class="w">  </span><span class="err">401089:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">47</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">4010d2</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x70</span><span class="p">&gt;</span>
<span class="w">  </span><span class="c1"># Part 2</span>
<span class="w">  </span><span class="err">40108</span><span class="nl">b:</span><span class="w">   </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="no">b6</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w"> </span><span class="mi">03</span><span class="w">             </span><span class="no">movzbl</span><span class="w"> </span><span class="p">(</span><span class="nv">%rbx</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nv">%ecx</span><span class="w">       </span><span class="c1"># %ecx = ((%rbx + %rax 处的 1byte 值) 零扩展至 32 位)</span>
<span class="w">  </span><span class="err">40108</span><span class="nl">f:</span><span class="w">   </span><span class="err">88</span><span class="w"> </span><span class="err">0</span><span class="nf">c</span><span class="w"> </span><span class="mi">24</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%cl</span><span class="p">,(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">               </span><span class="c1"># %rcx 的低八位 存入 %rsp 指向的地址</span>
<span class="w">  </span><span class="err">401092:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rdx</span><span class="w">              </span><span class="c1"># %rsp 地址处的内容传入 %rdx</span>
<span class="w">  </span><span class="err">401096:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">e2</span><span class="w"> </span><span class="mi">0</span><span class="no">f</span><span class="w">                </span><span class="no">and</span><span class="w">    </span><span class="no">$0xf</span><span class="p">,</span><span class="nv">%edx</span><span class="w">                </span><span class="c1"># %edx 与 0b1111 按位与，结果存入 %edx（也就是保留低四位值）</span>
<span class="w">  </span><span class="err">401099:</span><span class="w">   </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="no">b6</span><span class="w"> </span><span class="mi">92</span><span class="w"> </span><span class="no">b0</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="no">movzbl</span><span class="w"> </span><span class="mi">0x4024b0</span><span class="p">(</span><span class="nv">%rdx</span><span class="p">),</span><span class="nv">%edx</span><span class="w">      </span><span class="c1"># %edx = ((0x4024b0 + %rdx 处的 1byte 值) 零扩展至 32 位)</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">a0:</span><span class="w">   </span><span class="err">88</span><span class="w"> </span><span class="err">54</span><span class="w"> </span><span class="err">04</span><span class="w"> </span><span class="err">10</span><span class="w">             </span><span class="nf">mov</span><span class="w">    </span><span class="nv">%dl</span><span class="p">,</span><span class="mi">0x10</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">    </span><span class="c1"># %rdx 的低八位 存入地址 %rsp + %rax + 0x10 处</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">a4:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c0</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%rax</span><span class="w">                </span><span class="c1"># %rax++</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">a8:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">06</span><span class="w">             </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x6</span><span class="p">,</span><span class="nv">%rax</span><span class="w">                </span><span class="c1"># %rax 与 6 比较</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">ac:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="nf">dd</span><span class="w">                   </span><span class="no">jne</span><span class="w">    </span><span class="mh">40108b</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x29</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 如果不相等，回到 40108b</span>
<span class="w">  </span><span class="c1"># Part 3</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">ae:</span><span class="w">   </span><span class="nf">c6</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">movb</span><span class="w">   </span><span class="no">$0x0</span><span class="p">,</span><span class="mi">0x16</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">          </span><span class="c1"># *(%rsp+22) = 0x00，更直观的来说：rsp[22] = 0;</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">b3:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="mi">5</span><span class="no">e</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x40245e</span><span class="p">,</span><span class="nv">%esi</span><span class="w">           </span><span class="c1"># (gdb) x/s 0x40245e: "flyers"</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">b8:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">7</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x10</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rdi</span><span class="w">          </span><span class="c1"># %rdi = %rsp + 16（地址计算）</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">bd:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">76</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">401338</span> <span class="p">&lt;</span><span class="no">strings_not_equal</span><span class="p">&gt;</span><span class="w">   </span><span class="c1"># 比较两个字符串 %rdi 与 %rsi 是否不相等，不相等返回 1</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">c2:</span><span class="w">   </span><span class="err">85</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">test</span><span class="w">   </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># 这一部分和 Phase 1 相同的操作</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">c4:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">13</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">4010d9</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x77</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 两个字符串相等才会跳转，否则炸弹爆炸</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">c6:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">6</span><span class="no">f</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># BOOM!</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">cb:</span><span class="w">   </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="mi">1</span><span class="no">f</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">nopl</span><span class="w">   </span><span class="mi">0x0</span><span class="p">(</span><span class="nv">%rax</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">         </span><span class="c1"># 5 字节长度的 NOP 操作</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">d0:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">07</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">4010d9</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x77</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 跳转</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">d2:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># 我也不知道这两行有什么用</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">d7:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="no">b2</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">40108b</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x29</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 0_0</span>
<span class="w">  </span><span class="c1"># Part 4</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">d9:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">18</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">de:</span><span class="w">   </span><span class="err">64</span><span class="w"> </span><span class="err">48</span><span class="w"> </span><span class="err">33</span><span class="w"> </span><span class="err">04</span><span class="w"> </span><span class="err">25</span><span class="w"> </span><span class="err">28</span><span class="w"> </span><span class="err">00</span><span class="w">    </span><span class="nf">xor</span><span class="w">    </span><span class="nv">%fs</span><span class="p">:</span><span class="mi">0x28</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">e5:</span><span class="w">   </span><span class="err">00</span><span class="w"> </span><span class="err">00</span><span class="w"> </span>
<span class="w">  </span><span class="err">4010</span><span class="nl">e7:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">4010ee</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x8c</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">e9:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="no">fa</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400b30</span> <span class="p">&lt;</span><span class="no">__stack_chk_fail@plt</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">ee:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">20</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x20</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">f2:</span><span class="w">   </span><span class="err">5</span><span class="nf">b</span><span class="w">                      </span><span class="no">pop</span><span class="w">    </span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">f3:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span><span class="w">    </span>
</code></pre></div></td></tr></table></div>
<p>程序中有两处 <code>00 00</code> 有分隔作用，只要考虑 <code>401073 ~ 4010de</code> 的内容即可，其他的部分是 Canary 栈保护机制的体现，防攻击用的，无需深挖</p>
<p>先看这一部分：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># Part 1</span>
<span class="w">  </span><span class="err">401073:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="err">44</span><span class="w"> </span><span class="err">24</span><span class="w"> </span><span class="err">18</span><span class="w">          </span><span class="nf">mov</span><span class="w">    </span><span class="nv">%rax</span><span class="p">,</span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">          </span><span class="c1"># 将 %rax 的值存入栈地址 %rsp + 24 处</span>
<span class="w">  </span><span class="err">401078:</span><span class="w">   </span><span class="err">31</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">xor</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># 利用异或操作清零 %eax</span>
<span class="w">  </span><span class="err">40107</span><span class="nl">a:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">9</span><span class="no">c</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40131b</span> <span class="p">&lt;</span><span class="no">string_length</span><span class="p">&gt;</span><span class="w">   </span><span class="c1"># 返回字符串的长度</span>
<span class="w">  </span><span class="err">40107</span><span class="nl">f:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">06</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x6</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># 返回值与 6 比较</span>
<span class="w">  </span><span class="err">401082:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">4</span><span class="nf">e</span><span class="w">                   </span><span class="no">je</span><span class="w">     </span><span class="mh">4010d2</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x70</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 如果相等则跳转，否则爆炸</span>
<span class="w">  </span><span class="err">401084:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">b1</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># BOOM! </span>
<span class="w">  </span><span class="err">401089:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">47</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">4010d2</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x70</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>要求是输入一个长度为 <code>6</code> 的字符串，否则炸弹爆炸</p>
<p>接下来的一段可能不是很好理解，我们不妨先往后看：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># Part 3</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">ae:</span><span class="w">   </span><span class="nf">c6</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">movb</span><span class="w">   </span><span class="no">$0x0</span><span class="p">,</span><span class="mi">0x16</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">          </span><span class="c1"># *(%rsp+22) = 0x00，更直观的来说：rsp[22] = 0;</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">b3:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="mi">5</span><span class="no">e</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x40245e</span><span class="p">,</span><span class="nv">%esi</span><span class="w">           </span><span class="c1"># (gdb) x/s 0x40245e: "flyers"</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">b8:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">7</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x10</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rdi</span><span class="w">          </span><span class="c1"># %rdi = %rsp + 16（地址计算）</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">bd:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">76</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">401338</span> <span class="p">&lt;</span><span class="no">strings_not_equal</span><span class="p">&gt;</span><span class="w">   </span><span class="c1"># 比较两个字符串 %rdi 与 %rsi 是否不相等，不相等返回 1</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">c2:</span><span class="w">   </span><span class="err">85</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">test</span><span class="w">   </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># 这一部分和 Phase 1 相同的操作</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">c4:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">13</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">4010d9</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x77</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 两个字符串相等才会跳转，否则炸弹爆炸</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">c6:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">6</span><span class="no">f</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># BOOM!</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">cb:</span><span class="w">   </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="mi">1</span><span class="no">f</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">nopl</span><span class="w">   </span><span class="mi">0x0</span><span class="p">(</span><span class="nv">%rax</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">         </span><span class="c1"># 5 字节长度的 NOP 操作</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">d0:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">07</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">4010d9</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x77</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 跳转</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">d2:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                </span><span class="c1"># 我也不知道这两行有什么用</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">d7:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="no">b2</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">40108b</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x29</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 0_0</span>
</code></pre></div></td></tr></table></div>
<p>有了 Phase 1 的经验我们可以看出来，这部分代码是将 <code>%rdi</code> 设置为输入的六位字符串的起始位置（<code>4010b8</code>，结合前面的 <code>movb</code> 指令可以看得出来），为字符串添加一个 <code>\0</code> （<code>4010ae</code>），然后将这个字符串和 <code>0x40245e</code> 存储的字符串 <code>flyers</code> 进行比较，如果相同则拆弹成功。似乎和 Phase 1 没有区别</p>
<p>回头看之前的部分，这一部分大概率会对原始输入的字符串进行修改（否则就和 Phase 1 一模一样了）</p>
<p>（注释部分进行了更加明显的修改，没错我用 AI 修正了一下）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># Part 2</span>
<span class="w">  </span><span class="err">40108</span><span class="nl">b:</span><span class="w">   </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="no">b6</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w"> </span><span class="mi">03</span><span class="w">             </span><span class="no">movzbl</span><span class="w"> </span><span class="p">(</span><span class="nv">%rbx</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nv">%ecx</span><span class="w">       </span><span class="c1"># 从 %rbx + %rax 地址读取 1byte，零扩展至 32 位存入 %ecx</span>
<span class="w">  </span><span class="err">40108</span><span class="nl">f:</span><span class="w">   </span><span class="err">88</span><span class="w"> </span><span class="err">0</span><span class="nf">c</span><span class="w"> </span><span class="mi">24</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%cl</span><span class="p">,(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">               </span><span class="c1"># 将 %cl（%ecx 的低 8 位）存入栈顶 %rsp</span>
<span class="w">  </span><span class="err">401092:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rdx</span><span class="w">              </span><span class="c1"># 从栈顶 %rsp 读取 8byte 到 %rdx，实际只用到低 1byte</span>
<span class="w">  </span><span class="err">401096:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">e2</span><span class="w"> </span><span class="mi">0</span><span class="no">f</span><span class="w">                </span><span class="no">and</span><span class="w">    </span><span class="no">$0xf</span><span class="p">,</span><span class="nv">%edx</span><span class="w">                </span><span class="c1"># 保留 %edx 的低 4 位，其余清零</span>
<span class="w">  </span><span class="err">401099:</span><span class="w">   </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="no">b6</span><span class="w"> </span><span class="mi">92</span><span class="w"> </span><span class="no">b0</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="no">movzbl</span><span class="w"> </span><span class="mi">0x4024b0</span><span class="p">(</span><span class="nv">%rdx</span><span class="p">),</span><span class="nv">%edx</span><span class="w">      </span><span class="c1"># 从地址 0x4024b0 + %rdx 读取 1byte，零扩展至 32 位</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">a0:</span><span class="w">   </span><span class="err">88</span><span class="w"> </span><span class="err">54</span><span class="w"> </span><span class="err">04</span><span class="w"> </span><span class="err">10</span><span class="w">             </span><span class="nf">mov</span><span class="w">    </span><span class="nv">%dl</span><span class="p">,</span><span class="mi">0x10</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">    </span><span class="c1"># 将 %dl（%edx 的低 8 位）存入 %rsp + %rax + 16</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">a4:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c0</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%rax</span><span class="w">                </span><span class="c1"># %rax += 1（循环计数器递增）</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">a8:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">06</span><span class="w">             </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x6</span><span class="p">,</span><span class="nv">%rax</span><span class="w">                </span><span class="c1"># 比较 %rax ~ 6（检查是否循环 6 次）</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">ac:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="nf">dd</span><span class="w">                   </span><span class="no">jne</span><span class="w">    </span><span class="mh">40108b</span> <span class="p">&lt;</span><span class="no">phase_5</span><span class="p">+</span><span class="mi">0x29</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 若未完成 6 次循环，跳回 40108b</span>
</code></pre></div></td></tr></table></div>
<p>最后三行可以看得出来这部分内容进行了 6 次循环操作，对应了长度为 6 的输入字符串，大概率是对每一个字符进行了某种映射变换</p>
<p>不妨看一看 <code>0x4024b0</code> 处存储了什么内容：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>x<span class="w"> </span>0x4024b0
0x4024b0<span class="w"> </span>&lt;array.3449&gt;:<span class="w">  </span><span class="s2">"maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?"</span>
</code></pre></div></td></tr></table></div>
<p>后面那一串应该不用管，关键是前面的 <code>maduiersnfotvbyl</code> ，这样一串无序的字符串很像是一种映射表（<code>flyers</code> 这几个字母在这里都能找到）</p>
<p>也就是说，正确的输入（六位字符串）在经过映射之后会转化为 <code>flyers</code> ，或许会有一种很简单的假设：</p>
<table>
<thead>
<tr>
<th>input</th>
<th>a</th>
<th>b</th>
<th>c</th>
<th>d</th>
<th>e</th>
<th>f</th>
<th>g</th>
<th>h</th>
<th>i</th>
<th>j</th>
<th>k</th>
<th>l</th>
<th>m</th>
<th>n</th>
<th>o</th>
<th>p</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>(wrong)</strong> output</td>
<td>m</td>
<td>a</td>
<td>d</td>
<td>u</td>
<td>i</td>
<td>e</td>
<td>r</td>
<td>s</td>
<td>n</td>
<td>f</td>
<td>o</td>
<td>t</td>
<td>v</td>
<td>b</td>
<td>y</td>
<td>l</td>
</tr>
</tbody>
</table>
<p>当然事实不是这样，我们发现：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="err">40108</span><span class="nl">b:</span><span class="w">   </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="no">b6</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w"> </span><span class="mi">03</span><span class="w">             </span><span class="no">movzbl</span><span class="w"> </span><span class="p">(</span><span class="nv">%rbx</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nv">%ecx</span><span class="w">       </span><span class="c1"># 从 %rbx + %rax 地址读取 1byte，零扩展至 32 位存入 %ecx</span>
<span class="w">  </span><span class="err">40108</span><span class="nl">f:</span><span class="w">   </span><span class="err">88</span><span class="w"> </span><span class="err">0</span><span class="nf">c</span><span class="w"> </span><span class="mi">24</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%cl</span><span class="p">,(</span><span class="nv">%rsp</span><span class="p">)</span><span class="w">               </span><span class="c1"># 将 %cl（%ecx 的低 8 位）存入栈顶 %rsp</span>
<span class="w">  </span><span class="err">401092:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="mi">24</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rdx</span><span class="w">              </span><span class="c1"># 从栈顶 %rsp 读取 8byte 到 %rdx，实际只用到低 1byte</span>
<span class="w">  </span><span class="err">401096:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">e2</span><span class="w"> </span><span class="mi">0</span><span class="no">f</span><span class="w">                </span><span class="no">and</span><span class="w">    </span><span class="no">$0xf</span><span class="p">,</span><span class="nv">%edx</span><span class="w">                </span><span class="c1"># 保留 %edx 的低 4 位，其余清零</span>
</code></pre></div></td></tr></table></div>
<p>每个字符（作为 ASCII 形式）最终仅仅读取了最低的四位，也就是说只有最后四位是有用的</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="err">401099:</span><span class="w">   </span><span class="err">0</span><span class="nf">f</span><span class="w"> </span><span class="no">b6</span><span class="w"> </span><span class="mi">92</span><span class="w"> </span><span class="no">b0</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="no">movzbl</span><span class="w"> </span><span class="mi">0x4024b0</span><span class="p">(</span><span class="nv">%rdx</span><span class="p">),</span><span class="nv">%edx</span><span class="w">      </span><span class="c1"># 从地址 0x4024b0 + %rdx 读取 1byte，零扩展至 32 位</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">a0:</span><span class="w">   </span><span class="err">88</span><span class="w"> </span><span class="err">54</span><span class="w"> </span><span class="err">04</span><span class="w"> </span><span class="err">10</span><span class="w">             </span><span class="nf">mov</span><span class="w">    </span><span class="nv">%dl</span><span class="p">,</span><span class="mi">0x10</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">    </span><span class="c1"># 将 %dl（%edx 的低 8 位）存入 %rsp + %rax + 16</span>
</code></pre></div></td></tr></table></div>
<p>接下来这四位二进制内容 <code>%rdx</code> 作为偏移值加在了 <code>0x402400</code> 的地址处，新的 <code>%rdx</code> 又被转移到了 <code>%rsp + %rax + 16</code> （这个位置在之后用于检验字符串相等）</p>
<p>也就是说：字符串的每个字符对应的 ASCII 值的最低四位作为索引 <code>%edx</code> 映射 <code>maduiersnfotvbyl</code> （恰好是 16 位）的内容</p>
<table>
<thead>
<tr>
<th>input</th>
<th>0000</th>
<th>0001</th>
<th>0010</th>
<th>0011</th>
<th>0100</th>
<th>0101</th>
<th>0110</th>
<th>0111</th>
<th>1000</th>
<th>1001</th>
<th>1010</th>
<th>1011</th>
<th>1100</th>
<th>1101</th>
<th>1110</th>
<th>1111</th>
</tr>
</thead>
<tbody>
<tr>
<td>output</td>
<td>m</td>
<td>a</td>
<td>d</td>
<td>u</td>
<td>i</td>
<td>e</td>
<td>r</td>
<td>s</td>
<td>n</td>
<td>f</td>
<td>o</td>
<td>t</td>
<td>v</td>
<td>b</td>
<td>y</td>
<td>l</td>
</tr>
</tbody>
</table>
<p>所以正确答案的六个字符的 ASCII 码低四位应该依次为 <code>1001</code> <code>1111</code> <code>1110</code> <code>0101</code> <code>0110</code> <code>0111</code> ，比如 <code>ionefg</code> <code>yonuvw</code> </p>
<h3 id="phase-6">Phase 6</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">00000000004010</span><span class="nf">f4</span><span class="w"> </span><span class="err">&lt;</span><span class="no">phase_6</span><span class="err">&gt;</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Part 1</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">f4:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">56</span><span class="w">                   </span><span class="nf">push</span><span class="w">   </span><span class="nv">%r14</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">f6:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">55</span><span class="w">                   </span><span class="nf">push</span><span class="w">   </span><span class="nv">%r13</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">f8:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">54</span><span class="w">                   </span><span class="nf">push</span><span class="w">   </span><span class="nv">%r12</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">fa:</span><span class="w">   </span><span class="err">55</span><span class="w">                      </span><span class="nf">push</span><span class="w">   </span><span class="nv">%rbp</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">fb:</span><span class="w">   </span><span class="err">53</span><span class="w">                      </span><span class="nf">push</span><span class="w">   </span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">fc:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">50</span><span class="w">             </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x50</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">401100:</span><span class="w">   </span><span class="err">49</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">e5</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%r13</span>
<span class="w">  </span><span class="err">401103:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">e6</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rsi</span>
<span class="w">  </span><span class="err">401106:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">51</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40145c</span> <span class="p">&lt;</span><span class="no">read_six_numbers</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40110</span><span class="nl">b:</span><span class="w">   </span><span class="err">49</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">e6</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%r14</span>
<span class="w">  </span><span class="err">40110</span><span class="nl">e:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="nf">bc</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%r12d</span>
<span class="w">  </span><span class="c1"># Part 2</span>
<span class="w">  </span><span class="err">401114:</span><span class="w">   </span><span class="err">4</span><span class="nf">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="no">ed</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%r13</span><span class="p">,</span><span class="nv">%rbp</span>
<span class="w">  </span><span class="err">401117:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x0</span><span class="p">(</span><span class="nv">%r13</span><span class="p">),</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40111</span><span class="nl">b:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">e8</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40111</span><span class="nl">e:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">05</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x5</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">401121:</span><span class="w">   </span><span class="err">76</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">jbe</span><span class="w">    </span><span class="mh">401128</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x34</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401123:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401128:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%r12d</span>
<span class="w">  </span><span class="err">40112</span><span class="nl">c:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">fc</span><span class="w"> </span><span class="mi">06</span><span class="w">             </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x6</span><span class="p">,</span><span class="nv">%r12d</span>
<span class="w">  </span><span class="err">401130:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">21</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">401153</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x5f</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401132:</span><span class="w">   </span><span class="err">44</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">e3</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%r12d</span><span class="p">,</span><span class="nv">%ebx</span>
<span class="w">  </span><span class="err">401135:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">63</span><span class="w"> </span><span class="nf">c3</span><span class="w">                </span><span class="no">movslq</span><span class="w"> </span><span class="nv">%ebx</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">401138:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">84</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40113</span><span class="nl">b:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="err">45</span><span class="w"> </span><span class="err">00</span><span class="w">                </span><span class="nf">cmp</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,</span><span class="mi">0x0</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
<span class="w">  </span><span class="err">40113</span><span class="nl">e:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">jne</span><span class="w">    </span><span class="mh">401145</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x51</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401140:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">f5</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401145:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">c3</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">add</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%ebx</span>
<span class="w">  </span><span class="err">401148:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">fb</span><span class="w"> </span><span class="mi">05</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x5</span><span class="p">,</span><span class="nv">%ebx</span>
<span class="w">  </span><span class="err">40114</span><span class="nl">b:</span><span class="w">   </span><span class="err">7</span><span class="nf">e</span><span class="w"> </span><span class="no">e8</span><span class="w">                   </span><span class="no">jle</span><span class="w">    </span><span class="mh">401135</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x41</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40114</span><span class="nl">d:</span><span class="w">   </span><span class="err">49</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c5</span><span class="w"> </span><span class="mi">04</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x4</span><span class="p">,</span><span class="nv">%r13</span>
<span class="w">  </span><span class="err">401151:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="no">c1</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">401114</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x20</span><span class="p">&gt;</span>
<span class="w">  </span><span class="c1"># Part 3</span>
<span class="w">  </span><span class="err">401153:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">74</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">18</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rsi</span>
<span class="w">  </span><span class="err">401158:</span><span class="w">   </span><span class="err">4</span><span class="nf">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="no">f0</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%r14</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">40115</span><span class="nl">b:</span><span class="w">   </span><span class="nf">b9</span><span class="w"> </span><span class="mi">07</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x7</span><span class="p">,</span><span class="nv">%ecx</span>
<span class="w">  </span><span class="err">401160:</span><span class="w">   </span><span class="err">89</span><span class="w"> </span><span class="nf">ca</span><span class="w">                   </span><span class="no">mov</span><span class="w">    </span><span class="nv">%ecx</span><span class="p">,</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">401162:</span><span class="w">   </span><span class="err">2</span><span class="nf">b</span><span class="w"> </span><span class="mi">10</span><span class="w">                   </span><span class="no">sub</span><span class="w">    </span><span class="p">(</span><span class="nv">%rax</span><span class="p">),</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">401164:</span><span class="w">   </span><span class="err">89</span><span class="w"> </span><span class="err">10</span><span class="w">                   </span><span class="nf">mov</span><span class="w">    </span><span class="nv">%edx</span><span class="p">,(</span><span class="nv">%rax</span><span class="p">)</span>
<span class="w">  </span><span class="err">401166:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c0</span><span class="w"> </span><span class="mi">04</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x4</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">40116</span><span class="nl">a:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">39</span><span class="w"> </span><span class="nf">f0</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%rsi</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">40116</span><span class="nl">d:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="nf">f1</span><span class="w">                   </span><span class="no">jne</span><span class="w">    </span><span class="mh">401160</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x6c</span><span class="p">&gt;</span>
<span class="w">  </span><span class="c1"># Part 4</span>
<span class="w">  </span><span class="err">40116</span><span class="nl">f:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%esi</span>
<span class="w">  </span><span class="err">401174:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">21</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">401197</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xa3</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401176:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">52</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rdx</span><span class="p">),</span><span class="nv">%rdx</span>
<span class="w">  </span><span class="err">40117</span><span class="nl">a:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">c0</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">add</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40117</span><span class="nl">d:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="nf">c8</span><span class="w">                   </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%ecx</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40117</span><span class="nl">f:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="nf">f5</span><span class="w">                   </span><span class="no">jne</span><span class="w">    </span><span class="mh">401176</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x82</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401181:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">05</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">401188</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x94</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401183:</span><span class="w">   </span><span class="nf">ba</span><span class="w"> </span><span class="no">d0</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x6032d0</span><span class="p">,</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">401188:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="err">54</span><span class="w"> </span><span class="err">74</span><span class="w"> </span><span class="err">20</span><span class="w">          </span><span class="nf">mov</span><span class="w">    </span><span class="nv">%rdx</span><span class="p">,</span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rsi</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="w">  </span><span class="err">40118</span><span class="nl">d:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c6</span><span class="w"> </span><span class="mi">04</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x4</span><span class="p">,</span><span class="nv">%rsi</span>
<span class="w">  </span><span class="err">401191:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">fe</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x18</span><span class="p">,</span><span class="nv">%rsi</span>
<span class="w">  </span><span class="err">401195:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">14</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">4011ab</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xb7</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401197:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w"> </span><span class="mi">34</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rsi</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nv">%ecx</span>
<span class="w">  </span><span class="err">40119</span><span class="nl">a:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f9</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%ecx</span>
<span class="w">  </span><span class="err">40119</span><span class="nl">d:</span><span class="w">   </span><span class="err">7</span><span class="nf">e</span><span class="w"> </span><span class="no">e4</span><span class="w">                   </span><span class="no">jle</span><span class="w">    </span><span class="mh">401183</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x8f</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40119</span><span class="nl">f:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">a4:</span><span class="w">   </span><span class="nf">ba</span><span class="w"> </span><span class="no">d0</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x6032d0</span><span class="p">,</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">a9:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="no">cb</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">401176</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x82</span><span class="p">&gt;</span>
<span class="w">  </span><span class="c1"># Part 5</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">ab:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">5</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">20</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">b0:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">28</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x28</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">b5:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">74</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">50</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x50</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rsi</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">ba:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">d9</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rbx</span><span class="p">,</span><span class="nv">%rcx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">bd:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">10</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rax</span><span class="p">),</span><span class="nv">%rdx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">c0:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="err">51</span><span class="w"> </span><span class="err">08</span><span class="w">             </span><span class="nf">mov</span><span class="w">    </span><span class="nv">%rdx</span><span class="p">,</span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rcx</span><span class="p">)</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">c4:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c0</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x8</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">c8:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">39</span><span class="w"> </span><span class="nf">f0</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%rsi</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">cb:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">4011d2</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xde</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">cd:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">d1</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rdx</span><span class="p">,</span><span class="nv">%rcx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">d0:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="no">eb</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">4011bd</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xc9</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">d2:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="nf">c7</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">08</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="no">movq</span><span class="w">   </span><span class="no">$0x0</span><span class="p">,</span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rdx</span><span class="p">)</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">d9:</span><span class="w">   </span><span class="err">00</span><span class="w"> </span>
<span class="w">  </span><span class="c1"># Part 6</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">da:</span><span class="w">   </span><span class="nf">bd</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x5</span><span class="p">,</span><span class="nv">%ebp</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">df:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rbx</span><span class="p">),</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">e3:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">00</span><span class="w">                   </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rax</span><span class="p">),</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">e5:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="err">03</span><span class="w">                   </span><span class="nf">cmp</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,(</span><span class="nv">%rbx</span><span class="p">)</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">e7:</span><span class="w">   </span><span class="err">7</span><span class="nf">d</span><span class="w"> </span><span class="mi">05</span><span class="w">                   </span><span class="no">jge</span><span class="w">    </span><span class="mh">4011ee</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xfa</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">e9:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">4</span><span class="no">c</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">ee:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">5</span><span class="no">b</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rbx</span><span class="p">),</span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">f2:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">ed</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%ebp</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">f5:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="nf">e8</span><span class="w">                   </span><span class="no">jne</span><span class="w">    </span><span class="mh">4011df</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xeb</span><span class="p">&gt;</span>
<span class="w">  </span><span class="c1"># Part 7</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">f7:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">50</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x50</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">fb:</span><span class="w">   </span><span class="err">5</span><span class="nf">b</span><span class="w">                      </span><span class="no">pop</span><span class="w">    </span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">fc:</span><span class="w">   </span><span class="err">5</span><span class="nf">d</span><span class="w">                      </span><span class="no">pop</span><span class="w">    </span><span class="nv">%rbp</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">fd:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">5</span><span class="nf">c</span><span class="w">                   </span><span class="no">pop</span><span class="w">    </span><span class="nv">%r12</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">ff:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">5</span><span class="nf">d</span><span class="w">                   </span><span class="no">pop</span><span class="w">    </span><span class="nv">%r13</span>
<span class="w">  </span><span class="err">401201:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">5</span><span class="nf">e</span><span class="w">                   </span><span class="no">pop</span><span class="w">    </span><span class="nv">%r14</span>
<span class="w">  </span><span class="err">401203:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>太长了，我们一点一点的分析：</p>
<div class="admonition tip">
<p class="admonition-title">一些对较长的原程序的阶段划分方法</p>
<p><code>call &lt;explode_bomb&gt;</code> 可以帮助拆分一个程序的不同部分，虽然它不一定表示一个部分的结束</p>
<p>在之前的 <code>Phase</code> 遇到的相似代码也可以帮助拆分程序，让程序看上去更加有熟悉感</p>
<p><code>j</code> 类型指令也有一定的参考作用</p>
</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">00000000004010</span><span class="nf">f4</span><span class="w"> </span><span class="err">&lt;</span><span class="no">phase_6</span><span class="err">&gt;</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Part 1</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">f4:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">56</span><span class="w">                   </span><span class="nf">push</span><span class="w">   </span><span class="nv">%r14</span><span class="w">                     </span><span class="c1"># 一些压栈操作，这些寄存器都是 “被调用者保存寄存器”</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">f6:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">55</span><span class="w">                   </span><span class="nf">push</span><span class="w">   </span><span class="nv">%r13</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">f8:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">54</span><span class="w">                   </span><span class="nf">push</span><span class="w">   </span><span class="nv">%r12</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">fa:</span><span class="w">   </span><span class="err">55</span><span class="w">                      </span><span class="nf">push</span><span class="w">   </span><span class="nv">%rbp</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">fb:</span><span class="w">   </span><span class="err">53</span><span class="w">                      </span><span class="nf">push</span><span class="w">   </span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">4010</span><span class="nl">fc:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">50</span><span class="w">             </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x50</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">401100:</span><span class="w">   </span><span class="err">49</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">e5</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%r13</span>
<span class="w">  </span><span class="err">401103:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">e6</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rsi</span>
<span class="w">  </span><span class="err">401106:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">51</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40145c</span> <span class="p">&lt;</span><span class="no">read_six_numbers</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40110</span><span class="nl">b:</span><span class="w">   </span><span class="err">49</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">e6</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%r14</span>
<span class="w">  </span><span class="err">40110</span><span class="nl">e:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="nf">bc</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">       </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%r12d</span>
</code></pre></div></td></tr></table></div>
<p>读取六个数字分别位于 <code>%rsp</code> ~ <code>%rsp+0x14</code> 处，<code>%r13</code> <code>%r14</code> <code>%rsi</code> 都设置为 <code>%rsp</code> （也就是指向 <code>num1</code>），<code>%r12d</code> 设置为 <code>0</code> </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># Part 2</span>
<span class="w">  </span><span class="err">401114:</span><span class="w">   </span><span class="err">4</span><span class="nf">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="no">ed</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%r13</span><span class="p">,</span><span class="nv">%rbp</span>
<span class="w">  </span><span class="err">401117:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="mi">00</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x0</span><span class="p">(</span><span class="nv">%r13</span><span class="p">),</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40111</span><span class="nl">b:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">e8</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40111</span><span class="nl">e:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">05</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x5</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">401121:</span><span class="w">   </span><span class="err">76</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">jbe</span><span class="w">    </span><span class="mh">401128</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x34</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401123:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401128:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%r12d</span>
<span class="w">  </span><span class="err">40112</span><span class="nl">c:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">fc</span><span class="w"> </span><span class="mi">06</span><span class="w">             </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x6</span><span class="p">,</span><span class="nv">%r12d</span>
<span class="w">  </span><span class="err">401130:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">21</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">401153</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x5f</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401132:</span><span class="w">   </span><span class="err">44</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">e3</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%r12d</span><span class="p">,</span><span class="nv">%ebx</span>
<span class="w">  </span><span class="err">401135:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">63</span><span class="w"> </span><span class="nf">c3</span><span class="w">                </span><span class="no">movslq</span><span class="w"> </span><span class="nv">%ebx</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">401138:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">84</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40113</span><span class="nl">b:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="err">45</span><span class="w"> </span><span class="err">00</span><span class="w">                </span><span class="nf">cmp</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,</span><span class="mi">0x0</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
<span class="w">  </span><span class="err">40113</span><span class="nl">e:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">jne</span><span class="w">    </span><span class="mh">401145</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x51</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401140:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">f5</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401145:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">c3</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">add</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%ebx</span>
<span class="w">  </span><span class="err">401148:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">fb</span><span class="w"> </span><span class="mi">05</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x5</span><span class="p">,</span><span class="nv">%ebx</span>
<span class="w">  </span><span class="err">40114</span><span class="nl">b:</span><span class="w">   </span><span class="err">7</span><span class="nf">e</span><span class="w"> </span><span class="no">e8</span><span class="w">                   </span><span class="no">jle</span><span class="w">    </span><span class="mh">401135</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x41</span><span class="p">&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="mi">40114</span><span class="no">d</span><span class="p">:</span><span class="w">   </span><span class="mi">49</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="no">c5</span><span class="w"> </span><span class="mi">04</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x4</span><span class="p">,</span><span class="nv">%r13</span>
<span class="w">  </span><span class="err">401151:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="no">c1</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">401114</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x20</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>将 <code>%rbp</code> 设置为 <code>%r13</code>， <code>%eax</code> 设置为 <code>(%r13)</code> ，也就是 <code>num1</code>的值，然后将其减去 <code>1</code> 和 <code>5</code> 进行无符号比较，如果 <code>&lt;=</code> 成立就跳转，否则炸弹爆炸，这里说明第一个数字必须 <code>&lt;= 6</code> （注意到是无符号比较并且有减一操作，因此这个数也必须 <code>&gt;= 1</code>）。</p>
<p>接下来将 <code>%r12d</code> （此时为 <code>0</code>）自增并与 <code>6</code> 比较，如果相等就跳转到 <code>401153</code> 处（跳离上面的代码阶段）。这里是一个循环计数器的体现，循环六次。</p>
<p>否则将自增后的 <code>%r12d</code> （此时为 <code>1</code>）赋值给 <code>%ebx</code>，这个值经过符号扩展后传递给 <code>%rax</code>，接下来 <code>%eax</code> = <code>(%rsp + 4 * %rax)</code> ，这一部分的操作逻辑很像数组索引的计算，事实上 <code>%eax</code> 被赋值为 “下一个数字”</p>
<p>接下来比较 <code>%rbp</code> 指向的值与 <code>%eax</code> 内容是否相等，如果相等就爆炸，注意到 <code>%rbp</code> 是第一个数，因此以上的一轮操作是为了确保 “输入的前两个数不相等”</p>
<p>而接下来的三行指令（从 <code>401145</code> 开始）将 <code>%ebx</code> 自增并与 <code>5</code> 比较，如果 <code>&lt;=</code> 成立就回到 <code>401135</code> 重新进行 “再下一个数字” 与第一个数字的比较，可见 “第一个数应该与它后面的所有数都不一样”</p>
<p>最后是对 <code>%r13</code> 增加 <code>4</code> （一个数字的长度，也就是移动到下一个元素），进行以上所有操作的循环</p>
<p>这些内容可以总结为下面的 C 语言函数表示：<strong>检测输入的六个数是否可以组成 <code>1 2 3 4 5 6</code> 的某种无重复排列</strong>（比如 <code>2 5 1 4 6 3</code>）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">check_1_to_6_permutation</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nums</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">    </span><span class="c1">// 是否满足 1~6 的排列</span>
<span class="w">    </span><span class="c1">// 检查每个数字是否在 1-6 范围内</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="n">explode_bomb</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// 检查当前数字是否与后续数字重复</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nums</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="n">explode_bomb</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在了解了输入内容要求后继续分析下面的部分：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># Part 3</span>
<span class="w">  </span><span class="err">401153:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">74</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">18</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rsi</span>
<span class="w">  </span><span class="err">401158:</span><span class="w">   </span><span class="err">4</span><span class="nf">c</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="no">f0</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%r14</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">40115</span><span class="nl">b:</span><span class="w">   </span><span class="nf">b9</span><span class="w"> </span><span class="mi">07</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x7</span><span class="p">,</span><span class="nv">%ecx</span>
<span class="w">  </span><span class="err">401160:</span><span class="w">   </span><span class="err">89</span><span class="w"> </span><span class="nf">ca</span><span class="w">                   </span><span class="no">mov</span><span class="w">    </span><span class="nv">%ecx</span><span class="p">,</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">401162:</span><span class="w">   </span><span class="err">2</span><span class="nf">b</span><span class="w"> </span><span class="mi">10</span><span class="w">                   </span><span class="no">sub</span><span class="w">    </span><span class="p">(</span><span class="nv">%rax</span><span class="p">),</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">401164:</span><span class="w">   </span><span class="err">89</span><span class="w"> </span><span class="err">10</span><span class="w">                   </span><span class="nf">mov</span><span class="w">    </span><span class="nv">%edx</span><span class="p">,(</span><span class="nv">%rax</span><span class="p">)</span>
<span class="w">  </span><span class="err">401166:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c0</span><span class="w"> </span><span class="mi">04</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x4</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">40116</span><span class="nl">a:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">39</span><span class="w"> </span><span class="nf">f0</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%rsi</span><span class="p">,</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">40116</span><span class="nl">d:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="nf">f1</span><span class="w">                   </span><span class="no">jne</span><span class="w">    </span><span class="mh">401160</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x6c</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><code>%rsi</code> 的地址修改为 <code>%rsp + 0x18</code> ，<code>%rax</code> 被赋值为 <code>%r14</code> （<code>%r14</code> 在之前指向了 <code>num1</code> ），<code>%ecx</code> 设置为常数 <code>7</code> </p>
<p>将 <code>%edx</code> 设置为了 <code>7 - num1</code> （<code>%rcx</code> - <code>(%rax)</code>），然后将 <code>%rax</code> 指向的内容修改为了 <code>%edx</code> ，接着将 <code>%rax</code> 增加四（从而指向下一个数字），判断 <code>%rax</code> 和 <code>%rsi</code> 是否相同，不相同则跳转到赋值 <code>%edx</code> 的循环（循环计数器）</p>
<p>上面这一阶段的作用是将<strong>每一个数字 <code>num</code> 修改为 <code>7 - num</code></strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># Part 4</span>
<span class="w">  </span><span class="err">40116</span><span class="nl">f:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%esi</span>
<span class="w">  </span><span class="err">401174:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">21</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">401197</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xa3</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401176:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">52</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rdx</span><span class="p">),</span><span class="nv">%rdx</span>
<span class="w">  </span><span class="err">40117</span><span class="nl">a:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">c0</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">add</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40117</span><span class="nl">d:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="nf">c8</span><span class="w">                   </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%ecx</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40117</span><span class="nl">f:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="nf">f5</span><span class="w">                   </span><span class="no">jne</span><span class="w">    </span><span class="mh">401176</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x82</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401181:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">05</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">401188</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x94</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401183:</span><span class="w">   </span><span class="nf">ba</span><span class="w"> </span><span class="no">d0</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x6032d0</span><span class="p">,</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">401188:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="err">54</span><span class="w"> </span><span class="err">74</span><span class="w"> </span><span class="err">20</span><span class="w">          </span><span class="nf">mov</span><span class="w">    </span><span class="nv">%rdx</span><span class="p">,</span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rsi</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="w">  </span><span class="err">40118</span><span class="nl">d:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c6</span><span class="w"> </span><span class="mi">04</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x4</span><span class="p">,</span><span class="nv">%rsi</span>
<span class="w">  </span><span class="err">401191:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">fe</span><span class="w"> </span><span class="mi">18</span><span class="w">             </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x18</span><span class="p">,</span><span class="nv">%rsi</span>
<span class="w">  </span><span class="err">401195:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">14</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">4011ab</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xb7</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401197:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w"> </span><span class="mi">34</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rsp</span><span class="p">,</span><span class="nv">%rsi</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nv">%ecx</span>
<span class="w">  </span><span class="err">40119</span><span class="nl">a:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f9</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%ecx</span>
<span class="w">  </span><span class="err">40119</span><span class="nl">d:</span><span class="w">   </span><span class="err">7</span><span class="nf">e</span><span class="w"> </span><span class="no">e4</span><span class="w">                   </span><span class="no">jle</span><span class="w">    </span><span class="mh">401183</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x8f</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40119</span><span class="nl">f:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">a4:</span><span class="w">   </span><span class="nf">ba</span><span class="w"> </span><span class="no">d0</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x6032d0</span><span class="p">,</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">a9:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="no">cb</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">401176</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0x82</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>这一段开始出现了很多的跳转操作，我们尝试模拟一遍程序运行的流程。这里有一个 Mermaid 图表可供流程参考：</p>
<pre class="mermaid"><code>flowchart TD
    A["mov $0x0,%esi"]
    A --&gt; C["mov (%rsp,%rsi,1),%ecx"]
    C --&gt; D{"cmp $0x1,%ecx"}
    D --&gt;|ecx &lt;= 1| E["mov $0x6032d0,%edx"]
    D --&gt;|ecx &gt; 1| F["mov $0x1,%eax<br/>mov $0x6032d0,%edx"]
    F --&gt; I["mov 0x8(%rdx),%rdx"]
    I --&gt; J["add $0x1,%eax"]
    J --&gt; K{"cmp %ecx,%eax"}
    K --&gt;|eax != ecx| I
    K --&gt;|eax == ecx| M["mov %rdx,0x20(%rsp,%rsi,2)<br/>add $0x4,%rsi"]
    E --&gt; M
    M --&gt; O{"cmp $0x18,%rsi"}
    O --&gt;|rsi != 24| C
    O --&gt;|rsi == 24| P["Go to Part 5"]
</code></pre>
<p>看不懂也不要紧，我们不妨先看一下 <code>0x6032d0</code> 的内容：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">(</span><span class="nf">gdb</span><span class="p">)</span><span class="w"> </span><span class="no">x</span><span class="err">/</span><span class="mi">24</span><span class="w"> </span><span class="mi">0x6032d0</span>
<span class="err">0</span><span class="nf">x6032d0</span><span class="w"> </span><span class="err">&lt;</span><span class="no">node1</span><span class="err">&gt;</span><span class="p">:</span><span class="w">   </span><span class="mi">0x0000014c</span><span class="w">      </span><span class="mi">0x00000001</span><span class="w">      </span><span class="mi">0x006032e0</span><span class="w">      </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x6032e0</span><span class="w"> </span><span class="err">&lt;</span><span class="no">node2</span><span class="err">&gt;</span><span class="p">:</span><span class="w">   </span><span class="mi">0x000000a8</span><span class="w">      </span><span class="mi">0x00000002</span><span class="w">      </span><span class="mi">0x006032f0</span><span class="w">      </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x6032f0</span><span class="w"> </span><span class="err">&lt;</span><span class="no">node3</span><span class="err">&gt;</span><span class="p">:</span><span class="w">   </span><span class="mi">0x0000039c</span><span class="w">      </span><span class="mi">0x00000003</span><span class="w">      </span><span class="mi">0x00603300</span><span class="w">      </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603300</span><span class="w"> </span><span class="err">&lt;</span><span class="no">node4</span><span class="err">&gt;</span><span class="p">:</span><span class="w">   </span><span class="mi">0x000002b3</span><span class="w">      </span><span class="mi">0x00000004</span><span class="w">      </span><span class="mi">0x00603310</span><span class="w">      </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603310</span><span class="w"> </span><span class="err">&lt;</span><span class="no">node5</span><span class="err">&gt;</span><span class="p">:</span><span class="w">   </span><span class="mi">0x000001dd</span><span class="w">      </span><span class="mi">0x00000005</span><span class="w">      </span><span class="mi">0x00603320</span><span class="w">      </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603320</span><span class="w"> </span><span class="err">&lt;</span><span class="no">node6</span><span class="err">&gt;</span><span class="p">:</span><span class="w">   </span><span class="mi">0x000001bb</span><span class="w">      </span><span class="mi">0x00000006</span><span class="w">      </span><span class="mi">0x00000000</span><span class="w">      </span><span class="mi">0x00000000</span>
<span class="c1"># 注释               # 一个int数      # 一个序号       # 指向的地址，恰好是 node1 -&gt; node2 -&gt; ... -&gt; node6</span>
</code></pre></div></td></tr></table></div>
<p>从 <code>&lt;node&gt;</code> 这个标签来看， <code>0x6032d0</code> 开始的地址存储了一个链表，用 C 语言可以这么描述：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">              </span><span class="c1">// 当前节点的值</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">label</span><span class="p">;</span><span class="w">              </span><span class="c1">// 节点序号</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">node</span><span class="o">*</span><span class="w"> </span><span class="n">next</span><span class="p">;</span><span class="w">      </span><span class="c1">// 指向的下一节点地址</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>现在再结合 Mermaid 流程图看一遍这段程序：</p>
<p><code>%rsi</code> 作为最外部的循环计数器，初始化为 <code>0</code> ，每次加 <code>4</code> （<code>40118d</code>），加到 <code>24</code> 就停止循环，也就是 <code>for(int i = 0; i &lt; 6; i++)</code> </p>
<p>循环内，<code>mov (%rsp,%rsi,1),%ecx</code> 这一步可以看作 <code>int ECX = a[i]</code> ，其中 <code>a</code> 是存储了六个数字的数组（之前的阶段也有类似的程序），<code>%rsi</code> 很明显是一个偏移值，用来遍历整个数组</p>
<p>在 <code>%ecx</code> 被更新赋值以后，其与 <code>1</code> 进行比较：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>如果这个数 `&lt;= 1`（结合实际情况也就是判断是否为 `1`），就把 `%edx` 设置为 `0x6032d0` （也就是头节点 `node1` 的地址）

否则 `%ecx &gt; 1` ，此时将 `%eax` 设置为 `1` ，`%edx` 设置为 `0x6032d0` ，接下来将 `%rdx` 设置为 (`%rdx + 8`) （也就是下一个地址 `node-&gt;next`），将 `%rax` 加上一，重复操作直到 `%rcx == %rax`
</code></pre></div></td></tr></table></div>
<p>（也就是说： <code>%edx</code> 被设置为了第 <code>%ecx</code> 个节点的地址） </p>
<p>接下来 <code>mov %rdx,0x20(%rsp,%rsi,2)</code> 将 <code>%rdx</code> 复制到了 <code>(%rsp + 0x20 + 2 * %rsi)</code> 指向的地址处，这个操作将根据最外部的循环计数器遍历整个数组</p>
<p>总结：此阶段<strong>将输入的六个数作为节点序号，依次对应六个节点地址按顺序存储到从 <code>%rsp+20</code> 开始的栈空间处</strong>（构造一个地址数组）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># Part 5</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">ab:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">5</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">20</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rbx</span><span class="w">          </span><span class="c1"># 将上一个 Part 得到的地址数组的第一个地址存入 %rbx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">b0:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">28</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x28</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rax</span><span class="w">          </span><span class="c1"># %rax = %rsp + 40（第二个元素的地址）</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">b5:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">74</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">50</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x50</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rsi</span><span class="w">          </span><span class="c1"># %rsi = %rsp + 32 + 6*8（地址数组末尾后的地址，也就是arr.end()）</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">ba:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">d9</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rbx</span><span class="p">,</span><span class="nv">%rcx</span><span class="w">                </span><span class="c1"># %rcx = %rbx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">bd:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">10</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rax</span><span class="p">),</span><span class="nv">%rdx</span><span class="w">              </span><span class="c1"># %rdx = (%rax)</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">c0:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="err">51</span><span class="w"> </span><span class="err">08</span><span class="w">             </span><span class="nf">mov</span><span class="w">    </span><span class="nv">%rdx</span><span class="p">,</span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rcx</span><span class="p">)</span><span class="w">           </span><span class="c1"># %rdx 值复制到 (%rcx+8) 地址</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">c4:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c0</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x8</span><span class="p">,</span><span class="nv">%rax</span><span class="w">                </span><span class="c1"># %rax +=8</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">c8:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">39</span><span class="w"> </span><span class="nf">f0</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%rsi</span><span class="p">,</span><span class="nv">%rax</span><span class="w">                </span><span class="c1"># 比较 %rax ~ %rsi</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">cb:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">4011d2</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xde</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 如果相等就跳转至 4011d2</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">cd:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">d1</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rdx</span><span class="p">,</span><span class="nv">%rcx</span><span class="w">                </span><span class="c1"># 否则 %rcx = %rdx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">d0:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="no">eb</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">4011bd</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xc9</span><span class="p">&gt;</span><span class="w">    </span><span class="c1"># 并且跳回到 4011bd</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">d2:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="nf">c7</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">08</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">    </span><span class="no">movq</span><span class="w">   </span><span class="no">$0x0</span><span class="p">,</span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rdx</span><span class="p">)</span><span class="w">           </span><span class="c1"># %rax == %rsi 时，将 0 存储到内存地址为 %rdx + 8 的位置</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">d9:</span><span class="w">   </span><span class="err">00</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>不妨记上一个 Part 构造的地址数组为 <code>addr[6]</code>， 用 C++ 重写程序</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="nf">Part5</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">addr</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w">                          </span><span class="c1">// %rbx = addr[0]</span>
<span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">first</span><span class="p">;</span><span class="w">                          </span><span class="c1">// %rcx = %rbx</span>
<span class="w">    </span><span class="c1">// 从第二个元素开始遍历地址数组</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">                   </span><span class="c1">// for (%rax = &amp;addr[1], %rax &lt; addr.end(), %rax++) </span>
<span class="w">        </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">                    </span><span class="c1">// 当前节点的下一节点由 addr[i] 决定</span>
<span class="w">        </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span><span class="w">                    </span><span class="c1">// 移动到下一个节点 </span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w">                        </span><span class="c1">// 对应 movq $0x0,0x8(%rdx)，作用是终止链表</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">first</span><span class="p">;</span><span class="w">                                   </span><span class="c1">// 得到一个</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>0x6032d0</code> 处的原始链表记为 <code>node1 -&gt; ... -&gt; node6</code>，这一部分程序<strong>根据输入的六个数字顺序重新链接了链表</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># Part 6</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">da:</span><span class="w">   </span><span class="nf">bd</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x5</span><span class="p">,</span><span class="nv">%ebp</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">df:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rbx</span><span class="p">),</span><span class="nv">%rax</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">e3:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">00</span><span class="w">                   </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rax</span><span class="p">),</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">e5:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="err">03</span><span class="w">                   </span><span class="nf">cmp</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,(</span><span class="nv">%rbx</span><span class="p">)</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">e7:</span><span class="w">   </span><span class="err">7</span><span class="nf">d</span><span class="w"> </span><span class="mi">05</span><span class="w">                   </span><span class="no">jge</span><span class="w">    </span><span class="mh">4011ee</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xfa</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">e9:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">4</span><span class="no">c</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">ee:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">5</span><span class="no">b</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rbx</span><span class="p">),</span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">f2:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">ed</span><span class="w"> </span><span class="mi">01</span><span class="w">                </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x1</span><span class="p">,</span><span class="nv">%ebp</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">f5:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="nf">e8</span><span class="w">                   </span><span class="no">jne</span><span class="w">    </span><span class="mh">4011df</span> <span class="p">&lt;</span><span class="no">phase_6</span><span class="p">+</span><span class="mi">0xeb</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>这一部分程序的内容十分明显了：重新链接后的链表的存储的值必须降序，否则引爆炸弹。正确的链表连接方式是 <code>3 -&gt; 4 -&gt; 5 -&gt; 6 -&gt; 1 -&gt; 2</code></p>
<p>考虑到 Part 3 将每一个数 <code>num</code> 改写为 <code>7 - num</code> ，所以整个 Phase 最终的答案就是 <code>4 3 2 1 6 5</code> </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="c1"># Part 7</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">f7:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">50</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x50</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">fb:</span><span class="w">   </span><span class="err">5</span><span class="nf">b</span><span class="w">                      </span><span class="no">pop</span><span class="w">    </span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">fc:</span><span class="w">   </span><span class="err">5</span><span class="nf">d</span><span class="w">                      </span><span class="no">pop</span><span class="w">    </span><span class="nv">%rbp</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">fd:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">5</span><span class="nf">c</span><span class="w">                   </span><span class="no">pop</span><span class="w">    </span><span class="nv">%r12</span>
<span class="w">  </span><span class="err">4011</span><span class="nl">ff:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">5</span><span class="nf">d</span><span class="w">                   </span><span class="no">pop</span><span class="w">    </span><span class="nv">%r13</span>
<span class="w">  </span><span class="err">401201:</span><span class="w">   </span><span class="err">41</span><span class="w"> </span><span class="err">5</span><span class="nf">e</span><span class="w">                   </span><span class="no">pop</span><span class="w">    </span><span class="nv">%r14</span>
<span class="w">  </span><span class="err">401203:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>清理栈帧并恢复被调用者保存的寄存器，不需要多分析</p>
<h3 id="secret-phase">Secret Phase</h3>
<p>结束六个常规的 Phase 后并没有发现任何触发 Secret Phase 的代码段，这里采用了一个比较投机的操作：搜索出现了 <code>401242</code> 地址的函数</p>
<p>函数 <code>&lt;phase_defused&gt;</code> 的使用场景是：在 main 函数中，在每一个炸弹被拆除时被调用，而 <code>401630</code> 地址处出现了跳转至隐藏阶段的跳转函数，对这个函数的相关部分进行分析：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="err">4015</span><span class="nl">e1:</span><span class="w">   </span><span class="err">4</span><span class="nf">c</span><span class="w"> </span><span class="mi">8</span><span class="no">d</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x10</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%r8</span>
<span class="w">  </span><span class="err">4015</span><span class="nl">e6:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">4</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">0</span><span class="no">c</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0xc</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rcx</span>
<span class="w">  </span><span class="err">4015</span><span class="nl">eb:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">08</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rdx</span>
<span class="w">  </span><span class="err">4015</span><span class="nl">f0:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x402619</span><span class="p">,</span><span class="nv">%esi</span><span class="w">                   </span><span class="c1"># (gdb) x/s 0x402619: "%d %d %s"</span>
<span class="w">  </span><span class="err">4015</span><span class="nl">f5:</span><span class="w">   </span><span class="nf">bf</span><span class="w"> </span><span class="mi">70</span><span class="w"> </span><span class="mi">38</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x603870</span><span class="p">,</span><span class="nv">%edi</span><span class="w">                   </span><span class="c1"># 0x603870 &lt;input_strings+240&gt;: ""</span>
<span class="w">  </span><span class="err">4015</span><span class="nl">fa:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">f1</span><span class="w"> </span><span class="no">f5</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400bf0</span> <span class="p">&lt;</span><span class="no">__isoc99_sscanf@plt</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">4015</span><span class="nl">ff:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">03</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x3</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">401602:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="err">31</span><span class="w">                   </span><span class="nf">jne</span><span class="w">    </span><span class="mh">401635</span> <span class="p">&lt;</span><span class="no">phase_defused</span><span class="p">+</span><span class="mi">0x71</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401604:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x402622</span><span class="p">,</span><span class="nv">%esi</span><span class="w">                   </span><span class="c1"># 0x402622: "DrEvil"</span>
<span class="w">  </span><span class="err">401609:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">7</span><span class="no">c</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x10</span><span class="p">(</span><span class="nv">%rsp</span><span class="p">),</span><span class="nv">%rdi</span>
<span class="w">  </span><span class="err">40160</span><span class="nl">e:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="no">fd</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">401338</span> <span class="p">&lt;</span><span class="no">strings_not_equal</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401613:</span><span class="w">   </span><span class="err">85</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">test</span><span class="w">   </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">401615:</span><span class="w">   </span><span class="err">75</span><span class="w"> </span><span class="err">1</span><span class="nf">e</span><span class="w">                   </span><span class="no">jne</span><span class="w">    </span><span class="mh">401635</span> <span class="p">&lt;</span><span class="no">phase_defused</span><span class="p">+</span><span class="mi">0x71</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401617:</span><span class="w">   </span><span class="nf">bf</span><span class="w"> </span><span class="no">f8</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x4024f8</span><span class="p">,</span><span class="nv">%edi</span>
<span class="w">  </span><span class="err">40161</span><span class="nl">c:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">ef</span><span class="w"> </span><span class="no">f4</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400b10</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401621:</span><span class="w">   </span><span class="nf">bf</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x402520</span><span class="p">,</span><span class="nv">%edi</span>
<span class="w">  </span><span class="err">401626:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">e5</span><span class="w"> </span><span class="no">f4</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400b10</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40162</span><span class="nl">b:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">401630:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">0</span><span class="no">d</span><span class="w"> </span><span class="no">fc</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">401242</span> <span class="p">&lt;</span><span class="no">secret_phase</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>很明显这个特殊的密码是 <code>DrEvil</code> ，而正确输入密码的方式是在某个阶段的输入中输入两个整数 + 字符串（即 <code>DrEvil</code>）。</p>
<p>（具体一点来说：将 <code>0x402619</code> 作为输入格式，将 <code>0x603870</code> 作为输入（一定是之前某一个阶段的输入），提取出 <code>%s</code> 判断是否为 <code>DrEvil</code>）</p>
<p>我们知道 Phase 3 和 Phase 4 需要输入的都是两个数字，所以哪一个阶段应该多一个输入呢？我们不妨使用gdb调试，在 Phase 5 开始的时候打一个断点，然后检查 <code>0x603870</code> 的内容</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code>(gdb) break *0x401062
Breakpoint 1 at 0x401062
(gdb) r
Starting program: /home/nopthon/Desktop/bomb/bomb 
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Welcome to my fiendish little bomb. You have 6 phases with
which to blow yourself up. Have a nice day!
Border relations with Canada have never been better.
Phase 1 defused. How about the next one?
1 2 4 8 16 32
That's number 2.  Keep going!
2 707                                                                               # Phase 3 的输入
Halfway there!
1 0                                                                                 # Phase 4 的输入
So you got that one.  Try this one.
^_^(a breakpoint here)

Breakpoint 1, 0x0000000000401062 in phase_5 ()
(gdb) x/s 0x603870
0x603870 &lt;input_strings+240&gt;:   "1 0"                                               # Phase 4 的输入
</code></pre></div></td></tr></table></div>
<p>我们发现 <code>0x603870</code> 存储的是第四阶段的输入，因此在第四阶段的输入中多输入一个字符串 <code>DrEvil</code> 就可以进入隐藏阶段（比如 <code>1 0 DrEvil</code>）</p>
<p>下面是隐藏阶段的代码：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">0000000000401242</span><span class="w"> </span><span class="err">&lt;</span><span class="nf">secret_phase</span><span class="err">&gt;</span><span class="p">:</span>
<span class="w">  </span><span class="err">401242:</span><span class="w">   </span><span class="err">53</span><span class="w">                      </span><span class="nf">push</span><span class="w">   </span><span class="nv">%rbx</span><span class="w">                             </span><span class="c1"># 被调用者保存寄存器</span>
<span class="w">  </span><span class="err">401243:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40149e</span> <span class="p">&lt;</span><span class="no">read_line</span><span class="p">&gt;</span><span class="w">               </span><span class="c1"># 读取一行内容，返回值 %rax</span>
<span class="w">  </span><span class="err">401248:</span><span class="w">   </span><span class="nf">ba</span><span class="w"> </span><span class="mi">0</span><span class="no">a</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0xa</span><span class="p">,</span><span class="nv">%edx</span><span class="w">                        </span><span class="c1"># %edx = 10</span>
<span class="w">  </span><span class="err">40124</span><span class="nl">d:</span><span class="w">   </span><span class="nf">be</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%esi</span><span class="w">                        </span><span class="c1"># %esi = 0</span>
<span class="w">  </span><span class="err">401252:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">c7</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rax</span><span class="p">,</span><span class="nv">%rdi</span><span class="w">                        </span><span class="c1"># %rdi = %rax</span>
<span class="w">  </span><span class="err">401255:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">76</span><span class="w"> </span><span class="no">f9</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400bd0</span> <span class="p">&lt;</span><span class="no">strtol@plt</span><span class="p">&gt;</span><span class="w">              </span><span class="c1"># 调用 C 语言函数 strtol() ，字符串转化为 long 整数</span>
<span class="w">  </span><span class="err">40125</span><span class="nl">a:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">89</span><span class="w"> </span><span class="nf">c3</span><span class="w">                </span><span class="no">mov</span><span class="w">    </span><span class="nv">%rax</span><span class="p">,</span><span class="nv">%rbx</span><span class="w">                        </span><span class="c1"># 返回值（整数） %rax 存入 %rbx</span>
<span class="w">  </span><span class="err">40125</span><span class="nl">d:</span><span class="w">   </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="no">ff</span><span class="w">                </span><span class="no">lea</span><span class="w">    </span><span class="mi">-0</span><span class="no">x1</span><span class="p">(</span><span class="nv">%rax</span><span class="p">),</span><span class="nv">%eax</span><span class="w">                  </span><span class="c1"># %rax = %rax - 1 （地址计算）</span>
<span class="w">  </span><span class="err">401260:</span><span class="w">   </span><span class="err">3</span><span class="nf">d</span><span class="w"> </span><span class="no">e8</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x3e8</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                      </span><span class="c1"># %eax 与 1000 比较</span>
<span class="w">  </span><span class="err">401265:</span><span class="w">   </span><span class="err">76</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">jbe</span><span class="w">    </span><span class="mh">40126c</span> <span class="p">&lt;</span><span class="no">secret_phase</span><span class="p">+</span><span class="mi">0x2a</span><span class="p">&gt;</span><span class="w">       </span><span class="c1"># %eax &lt;= 1000 则跳转</span>
<span class="w">  </span><span class="err">401267:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">ce</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">            </span><span class="c1"># 否则 BOOM! </span>
<span class="w">  </span><span class="err">40126</span><span class="nl">c:</span><span class="w">   </span><span class="err">89</span><span class="w"> </span><span class="nf">de</span><span class="w">                   </span><span class="no">mov</span><span class="w">    </span><span class="nv">%ebx</span><span class="p">,</span><span class="nv">%esi</span><span class="w">                        </span><span class="c1"># %esi = %ebx （也就是之前的返回值）</span>
<span class="w">  </span><span class="err">40126</span><span class="nl">e:</span><span class="w">   </span><span class="nf">bf</span><span class="w"> </span><span class="no">f0</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x6030f0</span><span class="p">,</span><span class="nv">%edi</span>
<span class="w">  </span><span class="err">401273:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">8</span><span class="no">c</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">401204</span> <span class="p">&lt;</span><span class="no">fun7</span><span class="p">&gt;</span><span class="w">                    </span><span class="c1"># 调用 fun7 函数</span>
<span class="w">  </span><span class="err">401278:</span><span class="w">   </span><span class="err">83</span><span class="w"> </span><span class="nf">f8</span><span class="w"> </span><span class="mi">02</span><span class="w">                </span><span class="no">cmp</span><span class="w">    </span><span class="no">$0x2</span><span class="p">,</span><span class="nv">%eax</span><span class="w">                        </span><span class="c1"># 返回值 %eax 与 2 比较</span>
<span class="w">  </span><span class="err">40127</span><span class="nl">b:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">05</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">401282</span> <span class="p">&lt;</span><span class="no">secret_phase</span><span class="p">+</span><span class="mi">0x40</span><span class="p">&gt;</span><span class="w">       </span><span class="c1"># 如果相等就跳转（代表拆弹成功）</span>
<span class="w">  </span><span class="err">40127</span><span class="nl">d:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">b8</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">40143a</span> <span class="p">&lt;</span><span class="no">explode_bomb</span><span class="p">&gt;</span><span class="w">            </span><span class="c1"># 否则 BOOM!</span>
<span class="w">  </span><span class="err">401282:</span><span class="w">   </span><span class="nf">bf</span><span class="w"> </span><span class="mi">38</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x402438</span><span class="p">,</span><span class="nv">%edi</span><span class="w">                   </span><span class="c1"># 这里存的是拆弹成功的祝贺语 :)</span>
<span class="w">  </span><span class="err">401287:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">84</span><span class="w"> </span><span class="no">f8</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">400b10</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40128</span><span class="nl">c:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="mi">33</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">4015c4</span> <span class="p">&lt;</span><span class="no">phase_defused</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401291:</span><span class="w">   </span><span class="err">5</span><span class="nf">b</span><span class="w">                      </span><span class="no">pop</span><span class="w">    </span><span class="nv">%rbx</span>
<span class="w">  </span><span class="err">401292:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span><span class="w">    </span>
<span class="w">  </span><span class="mi">401293</span><span class="p">:</span><span class="w">   </span><span class="mi">90</span><span class="w">                      </span><span class="no">nop</span>
<span class="w">  </span><span class="na">...</span><span class="w"> </span><span class="no">...</span><span class="w"> </span><span class="c1"># 很多的 nop</span>
<span class="w">  </span><span class="err">40129</span><span class="nl">f:</span><span class="w">   </span><span class="err">90</span><span class="w">                      </span><span class="nf">nop</span>

<span class="err">0000000000401204</span><span class="w"> </span><span class="err">&lt;</span><span class="nf">fun7</span><span class="err">&gt;</span><span class="p">:</span>
<span class="w">  </span><span class="err">401204:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">ec</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">sub</span><span class="w">    </span><span class="no">$0x8</span><span class="p">,</span><span class="nv">%rsp</span><span class="w">                        </span><span class="c1"># 分配栈空间</span>
<span class="w">  </span><span class="err">401208:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">85</span><span class="w"> </span><span class="nf">ff</span><span class="w">                </span><span class="no">test</span><span class="w">   </span><span class="nv">%rdi</span><span class="p">,</span><span class="nv">%rdi</span>
<span class="w">  </span><span class="err">40120</span><span class="nl">b:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">2</span><span class="nf">b</span><span class="w">                   </span><span class="no">je</span><span class="w">     </span><span class="mh">401238</span> <span class="p">&lt;</span><span class="no">fun7</span><span class="p">+</span><span class="mi">0x34</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40120</span><span class="nl">d:</span><span class="w">   </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">17</span><span class="w">                   </span><span class="no">mov</span><span class="w">    </span><span class="p">(</span><span class="nv">%rdi</span><span class="p">),</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">40120</span><span class="nl">f:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="nf">f2</span><span class="w">                   </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%esi</span><span class="p">,</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">401211:</span><span class="w">   </span><span class="err">7</span><span class="nf">e</span><span class="w"> </span><span class="mi">0</span><span class="no">d</span><span class="w">                   </span><span class="no">jle</span><span class="w">    </span><span class="mh">401220</span> <span class="p">&lt;</span><span class="no">fun7</span><span class="p">+</span><span class="mi">0x1c</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401213:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">7</span><span class="no">f</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x8</span><span class="p">(</span><span class="nv">%rdi</span><span class="p">),</span><span class="nv">%rdi</span>
<span class="w">  </span><span class="err">401217:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">e8</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">401204</span> <span class="p">&lt;</span><span class="no">fun7</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">40121</span><span class="nl">c:</span><span class="w">   </span><span class="err">01</span><span class="w"> </span><span class="nf">c0</span><span class="w">                   </span><span class="no">add</span><span class="w">    </span><span class="nv">%eax</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40121</span><span class="nl">e:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">1</span><span class="no">d</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">40123d</span> <span class="p">&lt;</span><span class="no">fun7</span><span class="p">+</span><span class="mi">0x39</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401220:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0x0</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">401225:</span><span class="w">   </span><span class="err">39</span><span class="w"> </span><span class="nf">f2</span><span class="w">                   </span><span class="no">cmp</span><span class="w">    </span><span class="nv">%esi</span><span class="p">,</span><span class="nv">%edx</span>
<span class="w">  </span><span class="err">401227:</span><span class="w">   </span><span class="err">74</span><span class="w"> </span><span class="err">14</span><span class="w">                   </span><span class="nf">je</span><span class="w">     </span><span class="mh">40123d</span> <span class="p">&lt;</span><span class="no">fun7</span><span class="p">+</span><span class="mi">0x39</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401229:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">8</span><span class="nf">b</span><span class="w"> </span><span class="mi">7</span><span class="no">f</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="no">mov</span><span class="w">    </span><span class="mi">0x10</span><span class="p">(</span><span class="nv">%rdi</span><span class="p">),</span><span class="nv">%rdi</span>
<span class="w">  </span><span class="err">40122</span><span class="nl">d:</span><span class="w">   </span><span class="nf">e8</span><span class="w"> </span><span class="no">d2</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">call</span><span class="w">   </span><span class="mh">401204</span> <span class="p">&lt;</span><span class="no">fun7</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401232:</span><span class="w">   </span><span class="err">8</span><span class="nf">d</span><span class="w"> </span><span class="mi">44</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">01</span><span class="w">             </span><span class="no">lea</span><span class="w">    </span><span class="mi">0x1</span><span class="p">(</span><span class="nv">%rax</span><span class="p">,</span><span class="nv">%rax</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">401236:</span><span class="w">   </span><span class="nf">eb</span><span class="w"> </span><span class="mi">05</span><span class="w">                   </span><span class="no">jmp</span><span class="w">    </span><span class="mh">40123d</span> <span class="p">&lt;</span><span class="no">fun7</span><span class="p">+</span><span class="mi">0x39</span><span class="p">&gt;</span>
<span class="w">  </span><span class="err">401238:</span><span class="w">   </span><span class="nf">b8</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w"> </span><span class="no">ff</span><span class="w">          </span><span class="no">mov</span><span class="w">    </span><span class="no">$0xffffffff</span><span class="p">,</span><span class="nv">%eax</span>
<span class="w">  </span><span class="err">40123</span><span class="nl">d:</span><span class="w">   </span><span class="err">48</span><span class="w"> </span><span class="err">83</span><span class="w"> </span><span class="nf">c4</span><span class="w"> </span><span class="mi">08</span><span class="w">             </span><span class="no">add</span><span class="w">    </span><span class="no">$0x8</span><span class="p">,</span><span class="nv">%rsp</span>
<span class="w">  </span><span class="err">401241:</span><span class="w">   </span><span class="nf">c3</span><span class="w">                      </span><span class="no">ret</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>主函数部分的程序很清晰，主要关注 <code>fun7</code> 函数的内容</p>
<p>为了方便理解绘制出 <code>fun7</code> 的 Mermaid 示意图：</p>
<pre class="mermaid"><code>flowchart TD
    A[sub $0x8, %rsp] --&gt; B{"test %rdi, %rdi"}
    B --&gt;|%rdi == 0| C["mov $0xffffffff, %eax"]
    B --&gt;|%rdi != 0| D["mov (%rdi), %edx"]
    D --&gt; E{"cmp %esi, %edx"}
    E --&gt;|%edx &lt;= %esi| F["mov $0x0, %eax"]
    E --&gt;|%edx &gt; %esi| G["mov 0x8(%rdi), %rdi"]
    G --&gt; H["call fun7 (递归)"]
    H --&gt; I["add %eax, %eax"]
    I --&gt; J
    F --&gt; K{"cmp %esi, %edx"}
    K --&gt;|%edx == %esi| J
    K --&gt;|%edx != %esi| L["mov 0x10(%rdi), %rdi"]
    L --&gt; M["call fun7 (递归)"]
    M --&gt; N["lea 0x1(%rax,%rax,1), %eax"]
    N --&gt; J
    C --&gt; J
    J[add $0x8, %rsp]
    J --&gt; P["ret (返回)"]


</code></pre>
<p>存在递归，并且有搜索的模式，考虑是对一个树形数据结构的操作</p>
<p>在首次调用 <code>fun7</code> 前，被存入 <code>%edi</code> 的（<code>0x6030f0</code>）应该是一个数据结构的起点，可以用 gdb 进行访问</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># 0x6030f0 处的内容，被存入 %edi </span>
<span class="err">0</span><span class="nf">x6030f0</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n1</span><span class="err">&gt;</span><span class="p">:</span><span class="w">      </span><span class="mi">0x00000024</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00603110</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00603130</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603110</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n21</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x00000008</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00603190</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00603150</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603130</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n22</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x00000032</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00603170</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x006031b0</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603150</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n32</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x00000016</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00603270</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00603230</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603170</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n33</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x0000002d</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x006031d0</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00603290</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603190</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n31</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x00000006</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x006031f0</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00603250</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x6031b0</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n34</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x0000006b</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00603210</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x006032b0</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x6031d0</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n45</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x00000028</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x6031f0</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n41</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x00000001</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603210</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n47</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x00000063</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603230</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n44</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x00000023</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603250</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n42</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x00000007</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603270</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n43</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x00000014</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x603290</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n46</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x0000002f</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="err">0</span><span class="nf">x6032b0</span><span class="w"> </span><span class="err">&lt;</span><span class="no">n48</span><span class="err">&gt;</span><span class="p">:</span><span class="w">     </span><span class="mi">0x000003e9</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span><span class="w">  </span><span class="mi">0x00000000</span>
<span class="c1">#                   # 存储的值               # 左分支节点地址           # 右分支节点地址          # 填充对齐</span>
</code></pre></div></td></tr></table></div>
<p>从标签来看很像是一个二叉树结构，考虑每个节点分别存储的内容依次是：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">left</span><span class="p">;</span>
<span class="w">    </span><span class="n">Node</span><span class="o">*</span><span class="w"> </span><span class="n">right</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>据此绘制图像：</p>
<pre class="mermaid"><code>flowchart LR
    n1["n1 (0x6030f0)<br>val: 36"]

    n1 --&gt; n21["n21 (0x603110)<br>val: 8"]
    n1 --&gt; n22["n22 (0x603130)<br/>val: 50"]

    n21 --&gt; n31["n31 (0x603190)<br/>val: 6"]
    n21 --&gt; n32["n32 (0x603150)<br/>val: 22"]

    n22 --&gt; n33["n33 (0x603170)<br/>val: 45"]
    n22 --&gt; n34["n34 (0x6031b0)<br/>val: 107"]

    n31 --&gt; n41["n41 (0x6031f0)<br/>val: 1"]
    n31 --&gt; n42["n42 (0x603250)<br/>val: 7"]

    n32 --&gt; n43["n43 (0x603270)<br/>val: 20"]
    n32 --&gt; n44["n44 (0x603230)<br/>val: 35"]

    n33 --&gt; n45["n45 (0x6031d0)<br/>val: 40"]
    n33 --&gt; n46["n46 (0x603290)<br/>val: 47"]

    n34 --&gt; n47["n47 (0x603210)<br/>val: 99"]
    n34 --&gt; n48["n48 (0x6032b0)<br/>val: 1001"]
</br></br></code></pre>
<p>不难看出这是一个<a href="https://oiwiki.org/ds/bst/">二叉搜索树</a>，而 <code>fun7</code> 的作用可以用 C 语言这样表示：（参见<a href="https://oiwiki.org/ds/bst/#%E6%90%9C%E7%B4%A2%E5%85%83%E7%B4%A0">搜索元素</a>，代码非常相近）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">fun7</span><span class="p">(</span><span class="n">Node</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">                   </span><span class="c1">// %esi 是一个被查找的值</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w">                                  </span><span class="c1">// %rdi == 0 时，返回值 0xffffffff</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// %rdi != 0:</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">node_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span><span class="w">                     </span><span class="c1">// 40120d: mov (%rdi),%edx</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node_val</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">                        </span><span class="c1">// 401225: cmp %esi,%edx</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node_val</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w">                             </span><span class="c1">// node_val == value</span>

<span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fun7</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">     </span><span class="c1">// node_val &lt; value</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fun7</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">          </span><span class="c1">// node_val &gt; value</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>&lt;secret_phase&gt;</code> 主程序要求 <code>fun7</code> 的最终返回值为 <code>2</code>，因此被查找的值应该要从内到外逆推递归，计算<code>2 * (2 * 0 + 1)</code> 作为返回值</p>
<p>比如以 <code>n32</code> 这个节点为例，被查找的值为 <code>22</code>，那么向上逆推递归回到根节点的时候，经历了这样的步骤：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>// 第三层递归
return 0;           // 其实这里也可以是 2*0 的结果，对应节点 n43
// 第二层递归
return 2*fun7 + 1;  // 1
// 第一层递归
return 2*fun7;      // 2
</code></pre></div></td></tr></table></div>
<p>所以该阶段的最终答案为 <code>20</code> 或 <code>22</code> </p>
<hr/>
<h2 id="final-ans">Final Ans</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code>❯ ./bomb
Welcome to my fiendish little bomb. You have 6 phases with
which to blow yourself up. Have a nice day!
Border relations with Canada have never been better.            # Phase 1
Phase 1 defused. How about the next one?
1 2 4 8 16 32                                                   # Phase 2
That's number 2.  Keep going!
2 707                                                           # Phase 3
Halfway there!
1 0 DrEvil                                                      # Phase 4
So you got that one.  Try this one.
yonuvw                                                          # Phase 5
Good work!  On to the next...
4 3 2 1 6 5                                                     # Phase 6
Curses, you've found the secret phase!
But finding it and solving it are quite different...
22                                                              # Secret Phase
Wow! You've defused the secret stage!
Congratulations! You've defused the bomb!                       # Congrats!
</code></pre></div></td></tr></table></div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
<script src="../../../stylesheets/extra.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>